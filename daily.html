<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GenDaily</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* View Management */
        .view { display: none; height: 100%; flex-direction: column; opacity: 0; transition: opacity 0.2s ease-in-out; }
        .view.active { display: flex; opacity: 1; }
        
        /* Animations */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-[100dvh] w-screen overflow-hidden selection:bg-blue-100">
    
    <div id="app" class="h-full w-full max-w-md mx-auto bg-slate-50 md:border-x md:border-gray-200 relative shadow-2xl flex flex-col">
        
        <!-- ================= DASHBOARD VIEW ================= -->
        <div id="view-dashboard" class="view active relative">
            <!-- Header -->
            <div class="bg-blue-600 pb-6 pt-safe-top px-5 rounded-b-[2rem] shadow-lg shadow-blue-200 relative z-10 shrink-0">
                <!-- Top Padding Helper for status bars -->
                <div class="h-2"></div> 
                
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-lg font-bold flex items-center gap-2 text-white">
                        <i data-lucide="milk" class="fill-white w-5 h-5" stroke-width="2.5"></i>
                        GenDaily
                    </h1>
                    <div class="flex gap-2">
                        <!-- Sync Button -->
                        <button onclick="apiService.fetchAll(true)" class="bg-white/20 backdrop-blur-md p-2 rounded-lg hover:bg-white/30 transition-all text-white border border-white/10 active:scale-95">
                            <i id="icon-refresh" data-lucide="refresh-cw" class="w-4 h-4"></i>
                        </button>
                        <!-- Admin Button -->
                        <button onclick="router.navigate('admin')" class="bg-white/20 backdrop-blur-md p-2 rounded-lg hover:bg-white/30 transition-all text-white border border-white/10 active:scale-95">
                            <i data-lucide="file-text" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                
                <div class="flex flex-col items-center justify-center pb-2">
                    <div class="text-blue-200 text-[10px] font-semibold uppercase tracking-widest mb-0.5">Today's Sales</div>
                    <div class="text-4xl font-extrabold text-white tracking-tight">
                        <span class="text-2xl font-bold align-top opacity-70 mr-0.5">₹</span><span id="dashboard-total">0</span>
                    </div>
                </div>
            </div>

            <!-- List -->
            <div class="flex-1 -mt-4 px-4 overflow-y-auto pb-28 z-10 relative no-scrollbar" id="entry-list">
                <!-- Loading State -->
                <div class="flex flex-col items-center justify-center pt-16 opacity-50">
                    <i data-lucide="loader-2" class="w-6 h-6 spinner text-blue-600 mb-2"></i>
                    <p class="text-xs font-medium text-gray-500">Syncing...</p>
                </div>
            </div>

            <!-- FAB -->
            <div class="absolute bottom-8 right-6 z-40">
                <button onclick="router.navigate('entry')" class="w-14 h-14 bg-gray-900 text-white rounded-2xl shadow-xl shadow-gray-400/50 flex items-center justify-center hover:bg-black hover:scale-105 transition-all active:scale-95 border-2 border-white/10">
                    <i data-lucide="plus" class="w-7 h-7"></i>
                </button>
            </div>
        </div>

        <!-- ================= ENTRY VIEW ================= -->
        <div id="view-entry" class="view bg-gray-50 h-full relative">
            <!-- Nav -->
            <div class="px-5 pt-6 pb-2 flex items-center justify-between z-20 shrink-0">
                <button onclick="router.navigate('dashboard')" class="w-9 h-9 bg-white rounded-full flex items-center justify-center text-gray-500 shadow-sm border border-gray-100 active:scale-95 transition-transform">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
                <h2 class="text-base font-bold text-gray-800 tracking-tight">Add Entry</h2>
                <div class="w-9"></div>
            </div>

            <div class="flex-1 overflow-y-auto px-5 py-3 pb-32 space-y-4">
                <!-- Date -->
                <div class="bg-white p-1 rounded-xl shadow-sm border border-gray-100 flex items-center">
                    <div class="bg-blue-50 w-10 h-10 rounded-lg flex items-center justify-center text-blue-600 ml-1">
                        <i data-lucide="calendar" class="w-5 h-5"></i>
                    </div>
                    <input type="date" id="entry-date" class="flex-1 bg-transparent border-none text-gray-800 font-bold text-base p-2.5 focus:ring-0 outline-none">
                </div>

                <!-- Milk 500ml -->
                <div id="card-big" class="bg-white shadow-sm border border-gray-100 rounded-2xl p-4 transition-all duration-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-sm font-extrabold text-gray-800">Milk 500 ml</h3>
                            <p class="text-gray-400 font-medium text-[10px] mt-0.5">₹35 per pack</p>
                        </div>
                        <div class="text-right">
                             <div id="subtotal-big-wrap" class="hidden text-blue-600 font-bold">
                                 <span class="text-[10px] text-gray-400 font-normal mr-1"><span id="qty-disp-big">0</span> × 35 =</span>
                                 <span class="text-base">₹<span id="subtotal-big">0</span></span>
                             </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-1.5 flex items-center">
                        <button onclick="entryManager.updateQty('Big', -1)" class="w-10 h-10 bg-white rounded-lg shadow-sm text-gray-600 flex items-center justify-center active:scale-90"><i data-lucide="minus" class="w-4 h-4"></i></button>
                        <input type="number" id="input-big" value="0" readonly class="flex-1 bg-transparent text-center text-xl font-bold text-gray-800 outline-none w-full">
                        <button onclick="entryManager.updateQty('Big', 1)" id="btn-add-big" class="w-10 h-10 bg-gray-800 text-white rounded-lg shadow-md flex items-center justify-center active:scale-90"><i data-lucide="plus" class="w-4 h-4"></i></button>
                    </div>
                </div>

                <!-- Milk Small -->
                <div id="card-small" class="bg-white shadow-sm border border-gray-100 rounded-2xl p-4 transition-all duration-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-sm font-extrabold text-gray-800">Milk Small</h3>
                            <p class="text-gray-400 font-medium text-[10px] mt-0.5">₹11 per pack</p>
                        </div>
                        <div class="text-right">
                             <div id="subtotal-small-wrap" class="hidden text-blue-600 font-bold">
                                 <span class="text-[10px] text-gray-400 font-normal mr-1"><span id="qty-disp-small">0</span> × 11 =</span>
                                 <span class="text-base">₹<span id="subtotal-small">0</span></span>
                             </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-1.5 flex items-center">
                        <button onclick="entryManager.updateQty('Small', -1)" class="w-10 h-10 bg-white rounded-lg shadow-sm text-gray-600 flex items-center justify-center active:scale-90"><i data-lucide="minus" class="w-4 h-4"></i></button>
                        <input type="number" id="input-small" value="0" readonly class="flex-1 bg-transparent text-center text-xl font-bold text-gray-800 outline-none w-full">
                        <button onclick="entryManager.updateQty('Small', 1)" id="btn-add-small" class="w-10 h-10 bg-gray-800 text-white rounded-lg shadow-md flex items-center justify-center active:scale-90"><i data-lucide="plus" class="w-4 h-4"></i></button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="absolute bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-white via-white/95 to-transparent z-30 pb-8">
                <div id="entry-footer-empty" class="bg-gray-100 rounded-xl p-3 text-center text-gray-400 text-xs font-medium border border-gray-200 border-dashed">
                    <i data-lucide="alert-circle" class="mx-auto mb-1 opacity-50 w-4 h-4 inline"></i> Add items to save
                </div>
                <div id="entry-footer-active" class="hidden slide-up">
                    <div class="flex justify-between items-end mb-3 px-1">
                        <div>
                            <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-0.5">Total Payable</p>
                            <p class="text-2xl font-extrabold text-gray-900">₹<span id="total-cost">0</span></p>
                        </div>
                        <div class="text-right pb-1">
                            <span class="bg-blue-100 text-blue-700 px-2.5 py-0.5 rounded-full text-[10px] font-bold"><span id="total-qty">0</span> Packs</span>
                        </div>
                    </div>
                    <button onclick="entryManager.save()" id="btn-save" class="w-full bg-gray-900 text-white h-14 rounded-xl font-bold text-base flex items-center justify-center gap-2 shadow-xl hover:bg-black active:scale-[0.98] transition-all">
                        <span>Confirm Entry</span>
                        <i data-lucide="check" class="bg-white/20 rounded-full p-1 w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- ================= ADMIN VIEW ================= -->
        <div id="view-admin" class="view bg-slate-50 relative">
            <div class="bg-white border-b border-gray-100 p-4 sticky top-0 z-20 shrink-0">
                <div class="flex items-center gap-3">
                    <button onclick="router.navigate('dashboard')" class="p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-600">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <div class="flex-1">
                        <h2 class="text-base font-bold text-gray-800">Admin</h2>
                        <p class="text-[10px] text-gray-400 font-medium">Reports</p>
                    </div>
                </div>
            </div>
            
            <div class="p-5 space-y-4 flex-1 overflow-y-auto pb-10">
                <!-- Filter -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative">
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-1">Time Period</label>
                    <select id="admin-range" onchange="adminManager.onFilterChange()" class="w-full bg-gray-50 border border-gray-200 text-gray-800 text-sm font-bold p-2.5 rounded-lg outline-none appearance-none">
                        <option value="last_month">Last Month</option>
                        <option value="this_month">Current Month</option>
                        <option value="custom">Custom Date</option>
                    </select>
                    <i data-lucide="chevron-down" class="absolute right-6 top-[2.4rem] text-gray-400 pointer-events-none w-4 h-4"></i>

                    <!-- Custom Date Inputs -->
                    <div id="admin-custom-dates" class="hidden grid grid-cols-2 gap-3 mt-3 animate-in slide-in-from-top-2">
                        <div>
                            <label class="text-[10px] text-gray-400 font-bold uppercase ml-1">From</label>
                            <input type="date" id="admin-start" onchange="adminManager.render()" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs font-bold">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 font-bold uppercase ml-1">To</label>
                            <input type="date" id="admin-end" onchange="adminManager.render()" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs font-bold">
                        </div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-blue-600 text-white p-4 rounded-xl shadow-lg shadow-blue-200">
                        <div class="text-blue-100 text-[10px] font-semibold uppercase">Total Cost</div>
                        <div class="text-xl font-bold mt-0.5">₹<span id="admin-total-cost">0</span></div>
                    </div>
                    <div class="bg-white text-gray-800 p-4 rounded-xl shadow-sm border border-gray-100">
                        <div class="text-gray-400 text-[10px] font-bold uppercase">Quantity</div>
                        <div class="text-xl font-bold mt-0.5"><span id="admin-total-qty">0</span> <span class="text-xs font-normal text-gray-400">Packs</span></div>
                    </div>
                </div>

                <button onclick="adminManager.downloadPDF()" class="w-full bg-gray-900 text-white p-3.5 rounded-xl flex items-center justify-center gap-2 font-bold text-sm shadow-xl active:scale-95 transition-all">
                    <i data-lucide="download" class="w-4 h-4"></i> Download PDF
                </button>

                <!-- Table Preview -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table class="w-full text-xs text-left">
                        <thead class="bg-gray-50 text-gray-500 font-medium border-b border-gray-100">
                            <tr>
                                <th class="px-4 py-2.5">Date</th>
                                <th class="px-4 py-2.5">Item</th>
                                <th class="px-4 py-2.5 text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody id="admin-table-body" class="divide-y divide-gray-50">
                            <!-- Rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- APP LOGIC -->
    <script>
        // ==========================================
        //  CONFIG: HARDCODED SCRIPT URL
        // ==========================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzGyV6RkcxmMymYLYI-Q0cISEpMaoKjqBzwBym6ZcP4RhE9vRHkTcApTNy2q-WO05zsCg/exec";
        // ==========================================

        const PRICES = { 'Big': 35, 'Small': 11 };
        
        let state = {
            entries: [], 
            entryForm: { Big: 0, Small: 0 },
            loading: true
        };

        const router = {
            navigate: (viewId) => {
                document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
                document.getElementById('view-' + viewId).classList.add('active');
                
                if(viewId === 'dashboard') dashboardManager.render();
                if(viewId === 'entry') entryManager.reset();
                if(viewId === 'admin') adminManager.render();
                
                lucide.createIcons();
            }
        };

        const apiService = {
            fetchAll: async (manual = false) => {
                if(manual) {
                    const icon = document.getElementById('icon-refresh');
                    if(icon) icon.classList.add('spinner');
                    state.loading = true;
                    dashboardManager.render();
                }

                try {
                    const res = await fetch(SCRIPT_URL, { redirect: "follow" });
                    const data = await res.json();
                    
                    if(Array.isArray(data)) {
                        state.entries = data;
                        state.loading = false;
                        dashboardManager.render();
                        if(manual) alert("Sync Complete!");
                    } else {
                        throw new Error("Invalid data format");
                    }
                } catch (e) {
                    console.error("Fetch Error:", e);
                    state.loading = false;
                    
                    if(manual) alert("Sync Failed. Check internet.");
                    
                    document.getElementById('entry-list').innerHTML = `
                        <div class="p-8 text-center text-red-500">
                            <p>Failed to load data.</p>
                            <p class="text-xs text-gray-400 mt-2">Check internet connection</p>
                            <button onclick="apiService.fetchAll(true)" class="mt-4 bg-red-100 text-red-600 px-4 py-2 rounded-lg text-sm font-bold">Try Again</button>
                        </div>
                    `;
                } finally {
                    if(manual) {
                        const icon = document.getElementById('icon-refresh');
                        if(icon) icon.classList.remove('spinner');
                    }
                }
            },
            saveBatch: async (newEntries) => {
                for (let entry of newEntries) {
                    const formData = new FormData();
                    formData.append('date', entry.dateStr);
                    formData.append('milkType', entry.milkType);
                    formData.append('quantity', entry.quantity);
                    formData.append('costPerPouch', entry.costPerPouch);
                    formData.append('totalCost', entry.totalCost);

                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                }
                
                setTimeout(() => apiService.fetchAll(), 2000);
            }
        };

        const dashboardManager = {
            render: () => {
                const listEl = document.getElementById('entry-list');
                const totalEl = document.getElementById('dashboard-total');
                const today = new Date().toISOString().split('T')[0];
                
                if(state.loading) {
                     listEl.innerHTML = `
                        <div class="flex flex-col items-center justify-center pt-16 opacity-50">
                            <i data-lucide="loader-2" class="w-6 h-6 spinner text-blue-600 mb-2"></i>
                            <p class="text-xs font-medium text-gray-500">Syncing with Sheet...</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return; 
                }

                // Today Total
                const todayTotal = state.entries
                    .filter(e => e.dateStr === today)
                    .reduce((sum, e) => sum + Number(e.totalCost), 0);
                totalEl.innerText = todayTotal;

                if (state.entries.length === 0) {
                    listEl.innerHTML = `
                        <div class="bg-white p-6 rounded-2xl shadow-sm text-center text-gray-400 mt-4 border border-gray-100">
                            <i data-lucide="milk" class="mx-auto mb-2 w-6 h-6 opacity-50"></i>
                            <p class="text-sm">No entries found</p>
                        </div>`;
                } else {
                    const sorted = [...state.entries].sort((a,b) => (b.dateStr > a.dateStr) ? 1 : -1);
                    
                    listEl.innerHTML = sorted.map(e => `
                        <div class="bg-white p-3 mb-2.5 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-lg flex items-center justify-center text-sm font-bold ${String(e.milkType).includes('500') ? 'bg-blue-100 text-blue-600' : 'bg-orange-100 text-orange-600'}">
                                    ${e.quantity}
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800 text-sm">${e.milkType}</div>
                                    <div class="text-[10px] text-gray-400 flex items-center gap-1 mt-0.5">
                                        ${e.dateStr} • ₹${e.costPerPouch}/each
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-base text-gray-900">₹${e.totalCost}</div>
                            </div>
                        </div>
                    `).join('');
                }
                lucide.createIcons();
            }
        };

        const entryManager = {
            reset: () => {
                document.getElementById('entry-date').value = new Date().toISOString().split('T')[0];
                state.entryForm = { Big: 0, Small: 0 };
                entryManager.updateUI();
            },
            updateQty: (type, delta) => {
                const current = state.entryForm[type];
                const newVal = Math.max(0, current + delta);
                state.entryForm[type] = newVal;
                entryManager.updateUI();
            },
            updateUI: () => {
                const { Big, Small } = state.entryForm;
                const costBig = Big * PRICES.Big;
                const costSmall = Small * PRICES.Small;
                const total = costBig + costSmall;
                const totalQty = Big + Small;

                document.getElementById('input-big').value = Big;
                document.getElementById('input-small').value = Small;

                const updateCard = (type, qty, subtotal, idPrefix) => {
                    const card = document.getElementById(`card-${idPrefix}`);
                    const btn = document.getElementById(`btn-add-${idPrefix}`);
                    const subWrapper = document.getElementById(`subtotal-${idPrefix}-wrap`);
                    
                    document.getElementById(`qty-disp-${idPrefix}`).innerText = qty;
                    document.getElementById(`subtotal-${idPrefix}`).innerText = subtotal;

                    if (qty > 0) {
                        card.classList.add('ring-2', 'ring-blue-500', 'shadow-lg', 'shadow-blue-100');
                        card.classList.remove('border-gray-100');
                        btn.classList.replace('bg-gray-800', 'bg-blue-600');
                        subWrapper.classList.remove('hidden');
                    } else {
                        card.classList.remove('ring-2', 'ring-blue-500', 'shadow-lg', 'shadow-blue-100');
                        card.classList.add('border-gray-100');
                        btn.classList.replace('bg-blue-600', 'bg-gray-800');
                        subWrapper.classList.add('hidden');
                    }
                };

                updateCard('Big', Big, costBig, 'big');
                updateCard('Small', Small, costSmall, 'small');

                document.getElementById('total-cost').innerText = total;
                document.getElementById('total-qty').innerText = totalQty;
                
                if (total > 0) {
                    document.getElementById('entry-footer-empty').classList.add('hidden');
                    document.getElementById('entry-footer-active').classList.remove('hidden');
                } else {
                    document.getElementById('entry-footer-empty').classList.remove('hidden');
                    document.getElementById('entry-footer-active').classList.add('hidden');
                }
            },
            save: async () => {
                const btn = document.getElementById('btn-save');
                btn.disabled = true;
                btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-5 h-5"></i> Saving...`;
                lucide.createIcons();

                const dateStr = document.getElementById('entry-date').value;
                const { Big, Small } = state.entryForm;

                const newEntries = [];
                if (Big > 0) newEntries.push({ dateStr, milkType: 'Milk 500 ml', quantity: Big, costPerPouch: PRICES.Big, totalCost: Big * PRICES.Big });
                if (Small > 0) newEntries.push({ dateStr, milkType: 'Milk Small', quantity: Small, costPerPouch: PRICES.Small, totalCost: Small * PRICES.Small });

                // Optimistic Update
                state.entries.push(...newEntries); 
                
                await apiService.saveBatch(newEntries);

                router.navigate('dashboard');
            }
        };

        const adminManager = {
            onFilterChange: () => {
                const range = document.getElementById('admin-range').value;
                const customDiv = document.getElementById('admin-custom-dates');
                if(range === 'custom') {
                    customDiv.classList.remove('hidden');
                } else {
                    customDiv.classList.add('hidden');
                    adminManager.render();
                }
            },
            render: () => {
                const range = document.getElementById('admin-range').value;
                const now = new Date();
                let startStr, endStr;

                if (range === 'last_month') {
                    const start = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    const end = new Date(now.getFullYear(), now.getMonth(), 0);
                    startStr = start.toISOString().split('T')[0];
                    endStr = end.toISOString().split('T')[0];
                } else if (range === 'this_month') {
                    const start = new Date(now.getFullYear(), now.getMonth(), 1);
                    const end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    startStr = start.toISOString().split('T')[0];
                    endStr = end.toISOString().split('T')[0];
                } else {
                    // Custom
                    startStr = document.getElementById('admin-start').value;
                    endStr = document.getElementById('admin-end').value;
                }

                if (!startStr || !endStr) return; // Wait for inputs

                const filtered = state.entries.filter(e => e.dateStr >= startStr && e.dateStr <= endStr);
                
                const totalCost = filtered.reduce((a,b) => a + Number(b.totalCost), 0);
                const totalQty = filtered.reduce((a,b) => a + Number(b.quantity), 0);
                document.getElementById('admin-total-cost').innerText = totalCost;
                document.getElementById('admin-total-qty').innerText = totalQty;

                const tbody = document.getElementById('admin-table-body');
                if (filtered.length === 0) {
                     tbody.innerHTML = `<tr><td colspan="3" class="px-4 py-8 text-center text-gray-400">No data for selected period</td></tr>`;
                } else {
                    tbody.innerHTML = filtered.map(e => `
                        <tr>
                            <td class="px-4 py-2.5 text-gray-600 whitespace-nowrap">${e.dateStr}</td>
                            <td class="px-4 py-2.5 font-medium text-gray-800">${e.milkType}</td>
                            <td class="px-4 py-2.5 text-right font-bold text-blue-600">₹${e.totalCost}</td>
                        </tr>
                    `).join('');
                }
            },
            downloadPDF: () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(22);
                doc.setTextColor(37, 99, 235);
                doc.text(`GenDaily Report`, 14, 20);
                
                const rangeSelect = document.getElementById('admin-range');
                const rangeText = rangeSelect.options[rangeSelect.selectedIndex].text;
                doc.setFontSize(14);
                doc.setTextColor(100);
                doc.text(rangeText, 14, 30);

                const rows = [];
                const tbody = document.getElementById('admin-table-body').querySelectorAll('tr');
                tbody.forEach(tr => {
                    const cols = tr.querySelectorAll('td');
                    if(cols.length > 1) { // Skip "No data" row
                        rows.push([cols[0].innerText, cols[1].innerText, cols[2].innerText]);
                    }
                });

                if(rows.length === 0) { alert("No data to download"); return; }

                doc.autoTable({
                    startY: 40,
                    head: [['Date', 'Item', 'Total']],
                    body: rows,
                    theme: 'grid',
                    headStyles: { fillColor: [37, 99, 235] }
                });
                
                doc.save('GenDaily_Report.pdf');
            }
        };

        // Init
        const now = new Date();
        document.getElementById('admin-start').value = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
        document.getElementById('admin-end').value = now.toISOString().split('T')[0];

        // Start immediately
        apiService.fetchAll();

    </script>
</body>
</html>
