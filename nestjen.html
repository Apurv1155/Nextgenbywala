<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nestjen | Modern Property Marketplace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-orange: #FF7043;
            --brand-orange-hover: #F4511E;
            --soft-peach: #FFF5F2;
            --warm-white: #FFFFFF;
            --dark-gray: #2D3436;
            --medium-gray: #636E72;
            --light-gray: #DFE6E9;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--soft-peach);
            color: var(--dark-gray);
            line-height: 1.5;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--soft-peach); }
        ::-webkit-scrollbar-thumb { background: var(--brand-orange); border-radius: 10px; }

        /* Helpers */
        .max-w-7xl { max-width: 1280px; margin: 0 auto; padding: 0 20px; }
        .glass { background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none !important; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }
        .font-black { font-weight: 800; }
        .font-bold { font-weight: 700; }
        .uppercase { text-transform: uppercase; }
        .italic { font-style: italic; }
        .tracking-widest { letter-spacing: 0.1em; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.5s ease-out forwards; }

        /* Loader */
        #global-loader {
            position: fixed; inset: 0; z-index: 9999; background: rgba(255,255,255,0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(10px); transition: opacity 0.5s;
        }
        .spinner {
            width: 50px; height: 50px; border: 4px solid var(--brand-orange);
            border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Navigation */
        nav { position: fixed; top: 0; left: 0; right: 0; z-index: 100; transition: var(--transition-smooth); padding: 20px 0; }
        nav.scrolled { padding: 10px 0; }
        .nav-container { height: 70px; border-radius: 35px; padding: 0 30px; display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; cursor: pointer; text-decoration: none; color: inherit; }
        .logo-icon { width: 38px; height: 38px; background: var(--brand-orange); border-radius: 12px; margin-right: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .logo-text { font-size: 22px; font-weight: 800; letter-spacing: -1px; }
        .logo-text span { color: var(--brand-orange); }

        .search-bar { flex: 1; max-width: 400px; margin: 0 30px; position: relative; }
        .search-bar input { width: 100%; background: var(--soft-peach); border: none; padding: 12px 20px 12px 45px; border-radius: 18px; font-weight: 600; font-size: 14px; outline: none; }
        .search-bar svg { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--brand-orange); width: 18px; }

        .nav-links { display: flex; gap: 25px; align-items: center; }
        .nav-links button { background: none; border: none; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--medium-gray); cursor: pointer; transition: color 0.3s; }
        .nav-links button:hover { color: var(--brand-orange); }

        .auth-btn { background: var(--brand-orange); color: white; border: none; padding: 12px 24px; border-radius: 18px; font-size: 11px; font-weight: 800; text-transform: uppercase; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 112, 67, 0.2); transition: var(--transition-smooth); }
        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(255, 112, 67, 0.3); }

        .user-profile-badge { display: flex; align-items: center; gap: 12px; background: var(--soft-peach); padding: 6px 16px 6px 6px; border-radius: 20px; cursor: pointer; border: 1px solid white; transition: var(--transition-smooth); }
        .user-profile-badge:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        .user-avatar { width: 36px; height: 36px; border-radius: 14px; background: #FFE0D6; object-fit: cover; }
        .user-info p { font-size: 8px; font-weight: 800; text-transform: uppercase; color: var(--brand-orange); margin-bottom: 2px; }
        .user-info h4 { font-size: 11px; font-weight: 800; }

        /* Mobile Bottom Nav */
        .mobile-nav { position: fixed; bottom: 25px; left: 20px; right: 20px; z-index: 1000; height: 75px; border-radius: 35px; display: flex; justify-content: space-around; align-items: center; padding: 0 10px; display: none; box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.5); }
        .mobile-nav-item { display: flex; flex-direction: column; align-items: center; color: var(--medium-gray); text-decoration: none; gap: 4px; font-size: 8px; font-weight: 800; text-transform: uppercase; }
        .mobile-nav-item.active { color: var(--brand-orange); }
        .mobile-nav-item svg { width: 22px; height: 22px; }

        /* Mobile Floating Search Bar */
        .mobile-floating-search {
            position: fixed;
            bottom: 115px;
            left: 20px;
            right: 20px;
            z-index: 999;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 25px;
            padding: 8px 15px;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .mobile-floating-search input { width: 100%; background: transparent; border: none; padding: 10px 10px 10px 35px; font-weight: 700; font-size: 14px; outline: none; font-family: inherit; }
        .mobile-floating-search svg { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--brand-orange); width: 18px; }

        /* Hero */
        .hero { margin-top: 110px; margin-bottom: 60px; height: 550px; border-radius: 50px; overflow: hidden; position: relative; }
        .hero-slide { position: absolute; inset: 0; background-size: cover; background-position: center; transition: opacity 1.5s; opacity: 0; }
        .hero-slide.active { opacity: 1; }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); display: flex; flex-direction: column; justify-content: flex-end; padding: 60px; }
        .hero-content { color: white; max-width: 600px; }
        .hero-content h1 { font-size: 65px; font-weight: 800; line-height: 0.9; margin-bottom: 20px; letter-spacing: -3px; }
        .hero-content h1 span { color: var(--brand-orange); font-style: italic; }
        .hero-content p { color: rgba(255,255,255,0.8); font-size: 16px; margin-bottom: 30px; }
        .hero-btn { background: white; color: var(--dark-gray); border: none; padding: 18px 36px; border-radius: 25px; font-weight: 800; font-size: 11px; text-transform: uppercase; cursor: pointer; transition: var(--transition-smooth); }
        .hero-btn:hover { background: var(--brand-orange); color: white; }

        /* Property Grid */
        .section-header { margin-bottom: 40px; display: flex; align-items: flex-end; justify-content: space-between; }
        .section-title h2 { font-size: 42px; font-weight: 800; font-style: italic; letter-spacing: -2px; }
        .section-title h2 span { color: var(--brand-orange); }
        .section-title p { font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); margin-top: 8px; letter-spacing: 2px; }

        .property-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .property-card { background: white; border-radius: 35px; overflow: hidden; transition: var(--transition-smooth); border: 1px solid rgba(0,0,0,0.03); cursor: pointer; display: flex; flex-direction: column; }
        .property-card:hover { transform: translateY(-10px); box-shadow: 0 25px 50px rgba(255, 112, 67, 0.15); border-color: var(--soft-peach); }
        .card-image { position: relative; aspect-ratio: 4/3; overflow: hidden; }
        .card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s; }
        .property-card:hover .card-image img { transform: scale(1.1); }
        .card-badges { position: absolute; top: 15px; left: 15px; display: flex; gap: 8px; }
        .badge { background: var(--brand-orange); color: white; font-size: 9px; font-weight: 800; padding: 6px 12px; border-radius: 20px; text-transform: uppercase; }
        .badge-white { background: white; color: var(--brand-orange); }
        .save-btn { position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.8); border: none; display: flex; align-items: center; justify-content: center; color: var(--medium-gray); transition: 0.3s; cursor: pointer; }
        .save-btn.active { color: var(--brand-orange); }
        .card-body { padding: 25px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 18px; font-weight: 800; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: color 0.3s; }
        .property-card:hover .card-title { color: var(--brand-orange); }
        .card-location { font-size: 11px; font-weight: 700; color: var(--medium-gray); display: flex; align-items: center; gap: 5px; margin-bottom: 20px; }
        .card-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--soft-peach); display: flex; justify-content: space-between; align-items: center; }
        .card-price { font-size: 22px; font-weight: 800; color: var(--brand-orange); }
        .card-area { font-size: 9px; font-weight: 800; color: var(--medium-gray); text-transform: uppercase; margin-top: 2px; }
        .card-arrow { width: 38px; height: 38px; border-radius: 14px; background: var(--soft-peach); display: flex; align-items: center; justify-content: center; color: var(--brand-orange); transition: var(--transition-smooth); }
        .property-card:hover .card-arrow { background: var(--brand-orange); color: white; }

        /* Search Page Filters */
        .search-container { display: flex; gap: 40px; margin-top: 100px; }
        .sidebar { width: 320px; flex-shrink: 0; position: sticky; top: 100px; height: fit-content; background: white; border-radius: 40px; padding: 35px; transition: var(--transition-smooth); box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        .filter-group { margin-bottom: 30px; }
        .filter-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); letter-spacing: 1px; margin-bottom: 15px; display: block; }
        .filter-select { width: 100%; padding: 12px 20px; border-radius: 15px; border: 1px solid var(--light-gray); font-weight: 700; font-size: 13px; outline: none; }
        .filter-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .filter-btn { padding: 12px; border-radius: 15px; border: 2px solid var(--soft-peach); background: white; font-weight: 700; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .filter-btn.active { background: var(--brand-orange); border-color: var(--brand-orange); color: white; }

        .mobile-filter-trigger {
            display: none; width: 100%; background: white; border: 2px solid var(--brand-orange); color: var(--brand-orange); padding: 15px; border-radius: 20px; font-weight: 800; text-transform: uppercase; font-size: 11px; margin-bottom: 15px; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: var(--transition-smooth);
        }

        /* Property Details */
        .details-container { padding-top: 100px; padding-bottom: 120px; }
        .breadcrumb { font-size: 12px; color: var(--medium-gray); margin-bottom: 30px; cursor: default; }
        .breadcrumb span { cursor: pointer; transition: 0.3s; }
        .breadcrumb span:hover { color: var(--brand-orange); }
        .breadcrumb strong { color: var(--dark-gray); }
        .gallery-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 40px; }
        .main-image { border-radius: 40px; overflow: hidden; aspect-ratio: 16/9; box-shadow: 0 20px 40px rgba(0,0,0,0.05); cursor: pointer; position: relative; }
        .main-image .zoom-icon { position: absolute; bottom: 20px; right: 20px; background: rgba(255,255,255,0.9); color: var(--brand-orange); width: 44px; height: 44px; border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); transition: 0.3s; }
        .main-image:hover .zoom-icon { transform: scale(1.1); background: var(--brand-orange); color: white; }
        .main-image img { width: 100%; height: 100%; object-fit: cover; }
        .thumb-list { display: flex; flex-direction: column; gap: 15px; overflow-y: auto; max-height: 500px; padding-right: 10px; }
        .thumb-item { border-radius: 20px; overflow: hidden; aspect-ratio: 4/3; cursor: pointer; border: 3px solid transparent; transition: 0.3s; flex-shrink: 0; }
        .thumb-item.active { border-color: var(--brand-orange); }
        .thumb-item img { width: 100%; height: 100%; object-fit: cover; }
        .details-content { display: grid; grid-template-columns: 2fr 1.2fr; gap: 40px; }
        .info-card { background: white; border-radius: 40px; padding: 40px; margin-bottom: 30px; border: 1px solid var(--soft-peach); }
        .info-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; gap: 20px; }
        .info-title h1 { font-size: 36px; font-weight: 800; letter-spacing: -1.5px; line-height: 1.1; }
        .info-price { text-align: right; flex-shrink: 0; }
        .info-price h2 { font-size: 38px; font-weight: 800; color: var(--brand-orange); letter-spacing: -1px; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; padding: 30px 0; border-top: 1px solid var(--soft-peach); border-bottom: 1px solid var(--soft-peach); margin: 30px 0; }
        .stat-item p { font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); margin-bottom: 5px; }
        .stat-item h4 { font-size: 16px; font-weight: 800; }
        .amenities-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .amenity-item { display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; color: var(--medium-gray); }
        .amenity-dot { width: 6px; height: 6px; background: var(--brand-orange); border-radius: 50%; }

        /* Lightbox */
        .lightbox-overlay { position: fixed; inset: 0; z-index: 3000; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; padding: 20px; display: none; backdrop-filter: blur(10px); }
        .lightbox-overlay.active { display: flex; }
        .lightbox-img { max-width: 95%; max-height: 85vh; border-radius: 20px; object-fit: contain; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .lightbox-close { position: absolute; top: 30px; right: 30px; color: white; background: rgba(255,255,255,0.1); border: none; cursor: pointer; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .lightbox-close:hover { background: var(--brand-orange); }

        /* Sticky CTA Sidebar */
        .cta-sidebar { position: sticky; top: 100px; height: fit-content; }
        .builder-card { background: white; border-radius: 40px; padding: 35px; border: 1px solid var(--soft-peach); box-shadow: 0 30px 60px rgba(255,112,67,0.1); }
        .builder-info { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
        .builder-logo { width: 55px; height: 55px; border-radius: 18px; background: var(--soft-peach); color: var(--brand-orange); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 800; }
        .whatsapp-btn { width: 100%; background: #25D366; color: white; border: none; padding: 18px; border-radius: 20px; font-weight: 800; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: 0.3s; margin-bottom: 15px; }
        .whatsapp-btn:hover { background: #128C7E; transform: translateY(-3px); }
        .inquiry-btn { width: 100%; background: white; border: 2px solid var(--brand-orange); color: var(--brand-orange); padding: 18px; border-radius: 20px; font-weight: 800; font-size: 14px; cursor: pointer; transition: 0.3s; }
        .inquiry-btn:hover { background: var(--soft-peach); }

        /* Modals */
        .modal-overlay { position: fixed; inset: 0; z-index: 2000; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; padding: 20px; display: none; }
        .modal-overlay.active { display: flex; }
        .modal-card { background: white; border-radius: 50px; width: 100%; max-width: 500px; padding: 50px; position: relative; max-height: 90vh; overflow-y: auto; overflow-x: hidden; scrollbar-width: none; box-shadow: 0 30px 100px rgba(0,0,0,0.3); }
        .modal-card::-webkit-scrollbar { display: none; }
        .close-modal { position: absolute; top: 30px; right: 30px; border: none; background: rgba(0,0,0,0.05); color: var(--medium-gray); cursor: pointer; width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 10; transition: 0.3s; }
        .close-modal:hover { background: var(--brand-orange); color: white; transform: rotate(90deg); }
        
        /* AUTH UI */
        .auth-tabs { display: flex; background: var(--soft-peach); border-radius: 25px; padding: 6px; margin-bottom: 35px; }
        .auth-tab { flex: 1; border: none; background: none; padding: 14px; border-radius: 20px; font-weight: 800; font-size: 11px; text-transform: uppercase; cursor: pointer; color: var(--medium-gray); transition: 0.3s; }
        .auth-tab.active { background: white; color: var(--brand-orange); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        .profile-picker-container { position: relative; width: 130px; height: 130px; margin: 0 auto 35px; }
        .profile-picker { width: 100%; height: 100%; border-radius: 50%; background: var(--soft-peach); border: 4px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .profile-picker img { width: 100%; height: 100%; object-fit: cover; }
        .camera-btn { position: absolute; bottom: 0; right: 0; background: white; width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--brand-orange); box-shadow: 0 8px 20px rgba(0,0,0,0.1); cursor: pointer; border: 3px solid white; transition: 0.3s; }
        .camera-btn:hover { transform: scale(1.1); background: var(--brand-orange); color: white; }

        .form-group { margin-bottom: 20px; }
        .form-group label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); margin-bottom: 8px; display: block; }
        .form-input { width: 100%; background: var(--soft-peach); border: 2px solid transparent; border-radius: 18px; padding: 15px 20px; font-weight: 700; outline: none; transition: 0.3s; font-family: inherit; }
        .form-input:focus { border-color: var(--brand-orange); background: white; }
        .form-submit { width: 100%; background: var(--brand-orange); color: white; border: none; padding: 18px; border-radius: 20px; font-weight: 800; text-transform: uppercase; cursor: pointer; margin-top: 10px; transition: 0.3s; box-shadow: 0 10px 25px rgba(255, 112, 67, 0.3); }
        .form-submit:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(255, 112, 67, 0.3); }

        /* Profile Modal Premium UI */
        .profile-portal-wrapper { padding: 0 !important; overflow: hidden !important; }
        .profile-header { height: 180px; background: linear-gradient(135deg, var(--brand-orange), #FF8A65); border-radius: 40px 40px 0 0; display: flex; align-items: center; padding: 0 50px; position: relative; }
        .profile-header h2 { color: white; font-size: 42px; font-weight: 800; font-style: italic; letter-spacing: -2px; }
        .profile-avatar-large { width: 140px; height: 140px; border-radius: 45px; border: 8px solid white; position: absolute; bottom: -55px; right: 40px; background: #FFE0D6; object-fit: cover; box-shadow: 0 20px 40px rgba(0,0,0,0.1); z-index: 5; }
        .profile-content { padding: 80px 40px 40px 40px; }
        .profile-user-meta h3 { font-size: 32px; font-weight: 800; color: var(--dark-gray); line-height: 1.1; margin-bottom: 4px; }
        .profile-user-meta p { font-size: 11px; font-weight: 800; color: var(--brand-orange); text-transform: uppercase; letter-spacing: 1px; }

        .profile-stats-grid { display: flex; gap: 15px; margin: 35px 0; }
        .profile-stat-box { flex: 1; background: #FFF9F7; border: 1.5px solid rgba(255,112,67,0.05); padding: 25px 15px; border-radius: 35px; text-align: center; transition: 0.3s; }
        .profile-stat-box:hover { background: white; border-color: var(--brand-orange); transform: translateY(-3px); }
        .profile-stat-box label { font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--brand-orange); margin-bottom: 4px; display: block; }
        .profile-stat-box span { font-size: 36px; font-weight: 800; color: var(--dark-gray); line-height: 1; }

        .pending-list { margin-top: 30px; }
        .pending-card { background: white; border: 1.5px solid #FF7043; border-radius: 35px; padding: 30px; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(255,112,67,0.05); }
        .pending-card h5 { font-size: 18px; font-weight: 800; font-style: italic; margin-bottom: 15px; }
        .pending-progress { height: 8px; background: #FFEBE5; border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
        .pending-progress-bar { width: 40%; height: 100%; background: var(--brand-orange); border-radius: 4px; }

        .sign-out-btn { width: 100%; background: #FFF5F2; color: #FF4757; border: none; padding: 20px; border-radius: 25px; font-weight: 800; text-transform: uppercase; font-size: 13px; cursor: pointer; transition: 0.3s; margin-top: 15px; }
        .sign-out-btn:hover { background: #FFEEEE; }

        /* Listing Uploads */
        .image-uploader-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .image-uploader-box { aspect-ratio: 1; background: var(--soft-peach); border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 2px dashed var(--light-gray); transition: 0.3s; }
        .image-uploader-box:hover { border-color: var(--brand-orange); background: white; }
        .uploaded-img-box { aspect-ratio: 1; border-radius: 15px; overflow: hidden; position: relative; border: 1px solid var(--light-gray); }
        .uploaded-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .remove-img-btn { position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.8); color: white; border: none; width: 24px; height: 24px; border-radius: 50%; font-size: 12px; cursor: pointer; }

        /* Responsive */
        @media (max-width: 1024px) {
            .hero { height: 450px; }
            .hero-content h1 { font-size: 50px; }
            .details-content { grid-template-columns: 1fr; }
            .gallery-grid { grid-template-columns: 1fr; }
            .thumb-list { flex-direction: row; max-height: none; overflow-x: auto; padding-right: 0; padding-bottom: 10px; }
            .thumb-item { width: 120px; flex-shrink: 0; }
        }
        @media (max-width: 768px) {
            nav { padding: 15px 0; }
            .nav-links, .search-bar { display: none; }
            .mobile-nav { display: flex; }
            .hero { height: 380px; border-radius: 30px; margin-top: 85px; }
            .hero-overlay { padding: 25px; }
            .hero-content h1 { font-size: 34px; letter-spacing: -1.5px; }
            .section-title h2 { font-size: 28px; }
            .search-container { flex-direction: column; gap: 0px; }
            .sidebar { width: 100%; position: relative; top: 0; padding: 0px; max-height: 0; overflow: hidden; opacity: 0; margin-top: 0; border-radius: 30px; box-shadow: none; background: transparent; pointer-events: none; transition: var(--transition-smooth); }
            .sidebar.show { max-height: 1200px; opacity: 1; margin-top: 10px; margin-bottom: 25px; padding: 25px; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.1); pointer-events: auto; }
            .sidebar .section-title { display: none; }
            .mobile-filter-trigger { display: flex; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px 0; }
            .stat-item h4 { font-size: 14px; }
            .modal-card { padding: 30px; border-radius: 40px; }
            .profile-header { padding: 0 30px; height: 130px; }
            .profile-header h2 { font-size: 32px; }
            .profile-avatar-large { width: 110px; height: 110px; bottom: -45px; right: 30px; border-width: 6px; }
            .profile-content { padding: 65px 20px 30px 20px !important; }
            .profile-user-meta h3 { font-size: 26px; }
            .profile-stats-grid { gap: 10px; margin: 25px 0; }
            .profile-stat-box span { font-size: 30px; }
            .mobile-floating-search { display: block; }
            .info-card { padding: 20px; border-radius: 30px; }
            .info-title h1 { font-size: 22px; }
            .info-price h2 { font-size: 24px; }
            .details-container { padding-top: 85px; }
            .builder-card { padding: 20px; border-radius: 30px; }
            .main-image { border-radius: 25px; }
            .section-header { margin-bottom: 20px; align-items: flex-start; }
            .gallery-grid { gap: 10px; margin-bottom: 25px; }
            .thumb-item { border-radius: 15px; }
        }

        /* Utils */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.11.0"
  }
}
</script>
</head>
<body class="no-scrollbar">

    <div id="global-loader">
        <div class="spinner"></div>
        <p style="margin-top: 20px; font-weight: 800; color: var(--brand-orange); font-size: 10px; text-transform: uppercase; letter-spacing: 2px;">Loading marketplace...</p>
    </div>

    <nav id="navbar">
        <div class="max-w-7xl">
            <div class="nav-container glass">
                <a href="#/" class="logo">
                    <div class="logo-icon">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAABVlBMVEX///8AAAD/zWmAtv+gyP//fZcbGxuJ34//0WsyMjKDuv/5+fn/02z/z2qyj0mBuP+lzv/x8fHr6+uEvP9kfZ+wsLAiIiL/gZwZGRmo0v+ggUJsbGybm5v5yGeFvv+VlZUyKBXa2tpWVla6urrk5ORRc6F5rPEOFBxfX196enqrVGWhoaFAQEBMTExwWi7HoFJunNuKiooQEBDkt14oKCh7YzPExMTwwWPar1pRQSFyouM7VHVolNBHOR1gicBBUmiWvO8zSWbkcIeKbzm8l01fTCdNbpolNEkWHyxFYomDpNEbFQuJq9orIhJZf7IqPFRKJCwiERRYkFx6x4BoqWxKXXdacZAuOkpzkLc6MiT/36T/9+jOu5koOVFRZoKmhUT/7s//47D/1H+hmo0jLDh4O0eVSVjWaX85HCE4WzpMe08sSC4fMyE/Z0Jko2m/XnGLRFJ1v3qQrBkXAAAPPklEQVR4nO2d+1fbRhbHLWRA2FKwcQIkxDyNwRAwjyR2MKEYSMAhMW3aNNnNtuwjTbbZtkn+/19Wsqx5aGak0WjkEef4e07PIbZl69N779w7d0ZSJjPUUEMNNdRQQw011FCSlK+sbC7s1uZquwubK5W86tORrOLj3S0N1/Lu46Lq05KmlfU9jaaxuceqT02GigtUur5mN2+6uxZ3g/h6un+jGTfp7ulz1hXVpymsygMOPkfLU6pPVUybnHyObqIZ83MRADVtV/X5Rlben/807dnpdX3fUf369Anx7voNG3CKD30Ap/WyZZqWK/uPcv2R7xMPbhTi1Bh28k/PDBtuBJWNOXJrEfvUxA1CnJrG+OqmMUKRZVpnGOPWjUEszqLnfW1R+VzG8j30o3Oqz5xTmIs+bZgWC9CRuf8K+fSC6nPnEuaij4xAPltGeRv5/E0oxYso4L1gA7quaiCj6mz6Q7E4FhHQQTyFh9RUA4RpahYD5OBzEE3Eiin306lpAUAnOT4DRz1QzRCooogFe4hleFyai3BfDPID2iNqHRw4rRqDrSlxQDsvwlBMbSQKxmBfVuPSO3ZZNQlDMVzUNSKs3yqqWaiK5aI9wcFmUzUMTfFc1DUiyPtpdNO4LURG7VpSLoSaj7mshl2y6GisJm3VpSZjE5O6v6NKSZpYatnS7a3O8pPlUpKmrH5vS9mP0vXyIe3pDInh6P/H9N8anKmPof3vD/v0P8WAAAAABJRU5ErkJggg==" alt="Nestjen Logo" class="w-full h-full object-cover">
                    </div>
                    <div class="logo-text">Nest<span>jen</span></div>
                </a>

                <div class="search-bar">
                    <form id="global-search-form">
                        <input type="text" placeholder="Search for properties..." id="global-search-input">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </form>
                </div>

                <div class="nav-links" id="nav-actions">
                    <button onclick="router.navigate('#/search?type=Flat')">Flats</button>
                    <button onclick="router.navigate('#/search?type=Shop')">Shops</button>
                    <div style="height: 25px; width: 1px; background: var(--light-gray);"></div>
                    <!-- Auth action inserted here by JS -->
                </div>
            </div>
        </div>
    </nav>

    <div id="main-content">
        <!-- SPA Pages Rendered Here -->
    </div>

    <!-- Mobile Floating Search Bar (Only Bottom on Phone) -->
    <div class="mobile-floating-search" id="mobile-floating-search">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        <input type="text" placeholder="Search locations..." id="mobile-search-input">
    </div>

    <div class="mobile-nav glass" id="mobile-nav">
        <a href="#/" class="mobile-nav-item" data-path="#/">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span>Home</span>
        </a>
        <a href="#/search" class="mobile-nav-item" data-path="#/search">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <span>Search</span>
        </a>
        <a href="#/favs" class="mobile-nav-item" data-path="#/favs">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
            <span>Saved</span>
        </a>
        <a href="javascript:void(0)" class="mobile-nav-item" id="mobile-profile-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <span id="mobile-profile-text">Join</span>
        </a>
    </div>

    <!-- Modals -->
    <div id="modal-container" class="modal-overlay">
        <!-- Content injected by JS -->
    </div>

    <!-- Lightbox Overlay -->
    <div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
        <button class="lightbox-close"><svg width="24" height="24" fill="white" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" stroke="currentColor" stroke-width="1.5"/></svg></button>
        <img id="lightbox-img" src="" class="lightbox-img" alt="Fullscreen view">
    </div>

    <script>
        /**
         * Nestjen - Core Logic
         */

        const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz36Ajz6rXGm_QTRiLuBDiOz4sK0M-NrailgSVYc8PUOsq2nUnmMX0kFsOwnBA2CqtBsQ/exec";

        // State
        const state = {
            user: JSON.parse(localStorage.getItem('estate_user')) || null,
            properties: [],
            savedIds: JSON.parse(localStorage.getItem('savedProperties')) || [],
            pendingRequests: [],
            isLoading: true
        };

        // UI Utils
        const formatCurrency = (price) => {
            const num = parseFloat(price);
            if (isNaN(num) || num <= 0) return 'Price on Request';
            if (num >= 10000000) return `₹${(num / 10000000).toFixed(1).replace(/\.0$/, '')} Cr`;
            if (num >= 100000) return `₹${(num / 100000).toFixed(0)} Lacs`;
            return `₹${num.toLocaleString('en-IN')}`;
        };

        const showLoader = (show) => {
            const loader = document.getElementById('global-loader');
            if (show) loader.style.display = 'flex';
            else {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
            }
        };

        // Data Management
        async function fetchMarketplace() {
            try {
                const resp = await fetch(`${GAS_WEBAPP_URL}?action=fetch_public_feed`);
                const result = await resp.json();
                if (result.status === 'success') {
                    state.properties = result.data;
                }
            } catch (e) { console.error("Market fetch failed", e); }
            state.isLoading = false;
            showLoader(false);
            router.refresh();
        }

        async function syncPrivateStatus() {
            if (!state.user) return;
            try {
                const resp = await fetch(`${GAS_WEBAPP_URL}?action=fetch_statuses`);
                const result = await resp.json();
                if (result.status === 'success') { }
            } catch (e) {}
        }

        // Router
        const router = {
            currentPath: '',
            navigate(path) {
                window.location.hash = path;
            },
            refresh() {
                this.handleHashChange();
            },
            handleHashChange() {
                const hash = window.location.hash || '#/';
                this.currentPath = hash;
                
                document.querySelectorAll('.mobile-nav-item').forEach(el => {
                    el.classList.toggle('active', el.dataset.path === hash);
                });

                const content = document.getElementById('main-content');
                const floatingSearch = document.getElementById('mobile-floating-search');
                
                content.innerHTML = '';
                window.scrollTo(0, 0);

                if (hash === '#/search' || hash.startsWith('#/search?')) {
                    floatingSearch.style.display = window.innerWidth <= 768 ? 'block' : 'none';
                } else {
                    floatingSearch.style.display = 'none';
                }

                if (hash === '#/' || hash === '') {
                    renderHome(content);
                } else if (hash.startsWith('#/property/')) {
                    const id = hash.split('/').pop();
                    renderDetails(content, id);
                } else if (hash === '#/search' || hash.startsWith('#/search?')) {
                    const params = new URLSearchParams(hash.split('?')[1] || '');
                    renderSearch(content, params);
                } else if (hash === '#/favs') {
                    renderSearch(content, null, true);
                }

                updateNavActions();
            }
        };

        function updateNavActions() {
            const navActions = document.getElementById('nav-actions');
            const mobProfileText = document.getElementById('mobile-profile-text');
            
            if (state.user) {
                navActions.innerHTML = `
                    <button onclick="router.navigate('#/search?type=Flat')">Flats</button>
                    <button onclick="router.navigate('#/search?type=Shop')">Shops</button>
                    <div style="height: 25px; width: 1px; background: var(--light-gray);"></div>
                    <div class="user-profile-badge" onclick="openProfileModal()">
                        <img src="${state.user.photo || 'https://picsum.photos/100/100'}" class="user-avatar">
                        <div class="user-info">
                            <p>Member</p>
                            <h4>${state.user.name.split(' ')[0]}</h4>
                        </div>
                    </div>
                `;
                mobProfileText.innerText = 'Profile';
            } else {
                navActions.innerHTML = `
                    <button onclick="router.navigate('#/search?type=Flat')">Flats</button>
                    <button onclick="router.navigate('#/search?type=Shop')">Shops</button>
                    <div style="height: 25px; width: 1px; background: var(--light-gray);"></div>
                    <button class="auth-btn" onclick="openLoginModal()">Join Nestjen</button>
                `;
                mobProfileText.innerText = 'Join';
            }
        }

        function renderPropertyCard(p) {
            const isSaved = state.savedIds.includes(p.id);
            return `
                <article class="property-card animate-fade" onclick="router.navigate('#/property/${p.id}')">
                    <div class="card-image">
                        <img src="${p.images[0]}" alt="${p.title}" loading="lazy">
                        <div class="card-badges">
                            <span class="badge">${p.type}</span>
                            ${p.featured ? '<span class="badge badge-white">Verified</span>' : ''}
                        </div>
                        <button class="save-btn ${isSaved ? 'active' : ''}" onclick="toggleSave(event, '${p.id}')">
                            <svg class="w-4 h-4" fill="${isSaved ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                        </button>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">${p.title}</h3>
                        <p class="card-location">
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                            ${p.location}
                        </p>
                        <div class="card-footer">
                            <div>
                                <p class="card-price">${formatCurrency(p.price)}</p>
                                <p class="card-area">${p.area} SQ.FT</p>
                            </div>
                            <div class="card-arrow">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </div>
                        </div>
                    </div>
                </article>
            `;
        }

        function renderHome(container) {
            container.innerHTML = `
                <main class="max-w-7xl">
                    <section class="hero glass animate-fade">
                        <div class="hero-slide active" style="background-image: url('https://images.unsplash.com/photo-1600585154340-be6199f7d009?auto=format&fit=crop&w=1600&q=80')"></div>
                        <div class="hero-overlay">
                            <div class="hero-content">
                                <h1>Modern Living <span>Refined.</span></h1>
                                <p>Discover verified properties hand-picked for our community.</p>
                                <button class="hero-btn" onclick="router.navigate('#/search')">Explore Listings</button>
                            </div>
                        </div>
                    </section>

                    <section class="section-header">
                        <div class="section-title">
                            <h2>Market <span>Feed.</span></h2>
                            <p>Handpicked premium listings</p>
                        </div>
                    </section>

                    <div class="property-grid">
                        ${state.properties.length > 0 ? 
                            state.properties.slice(0, 12).map(p => renderPropertyCard(p)).join('') : 
                            '<p style="grid-column: 1/-1; text-align: center; padding: 50px; opacity: 0.5;">Finding the best properties for you...</p>'
                        }
                    </div>
                </main>
            `;
        }

        function renderSearch(container, params, isFavMode = false) {
            let filtered = [...state.properties];
            
            if (isFavMode) {
                filtered = filtered.filter(p => state.savedIds.includes(p.id));
            } else if (params) {
                const q = params.get('q')?.toLowerCase() || '';
                const type = params.get('type') || 'All';
                const city = params.get('city') || 'All';
                
                if (q) filtered = filtered.filter(p => p.title.toLowerCase().includes(q) || p.location.toLowerCase().includes(q));
                if (type !== 'All') filtered = filtered.filter(p => p.type === type);
                if (city !== 'All') filtered = filtered.filter(p => p.city === city);
            }

            container.innerHTML = `
                <div class="max-w-7xl search-container">
                    <button class="mobile-filter-trigger animate-fade" onclick="toggleSidebar()">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16m-7 6h7" stroke-width="2.5" stroke-linecap="round"/></svg>
                        Adjust Filters
                    </button>
                    
                    <aside class="sidebar animate-fade" id="search-sidebar">
                        <div class="section-title" style="margin-bottom: 30px;">
                            <h2 style="font-size: 24px;">Filters.</h2>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Asset Type</label>
                            <div class="filter-btn-grid" id="type-filter">
                                <button class="filter-btn ${(!params || params.get('type') === 'All') ? 'active' : ''}" onclick="applyFilter('type', 'All')">All</button>
                                <button class="filter-btn ${(params?.get('type') === 'Flat') ? 'active' : ''}" onclick="applyFilter('type', 'Flat')">Flats</button>
                                <button class="filter-btn ${(params?.get('type') === 'Shop') ? 'active' : ''}" onclick="applyFilter('type', 'Shop')">Shops</button>
                                <button class="filter-btn ${(params?.get('type') === 'Plot') ? 'active' : ''}" onclick="applyFilter('type', 'Plot')">Plots</button>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">City</label>
                            <select class="filter-select" onchange="applyFilter('city', this.value)">
                                <option value="All" ${(!params || params.get('city') === 'All') ? 'selected' : ''}>All Regions</option>
                                <option value="Ahmedabad" ${(params?.get('city') === 'Ahmedabad') ? 'selected' : ''}>Ahmedabad</option>
                                <option value="Gandhinagar" ${(params?.get('city') === 'Gandhinagar') ? 'selected' : ''}>Gandhinagar</option>
                            </select>
                        </div>
                        <button class="form-submit" style="margin-top: 20px;" onclick="router.navigate('#/favs')">My Saved Assets</button>
                    </aside>
                    
                    <section style="flex: 1">
                        <div class="section-header">
                            <div class="section-title">
                                <h2>${isFavMode ? 'Saved <span>Assets.</span>' : filtered.length + ' <span>Found.</span>'}</h2>
                            </div>
                        </div>
                        <div class="property-grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr))">
                            ${filtered.map(p => renderPropertyCard(p)).join('')}
                        </div>
                        ${filtered.length === 0 ? '<div style="text-align: center; padding: 100px 0; opacity: 0.5">No matching results found.</div>' : ''}
                    </section>
                </div>
            `;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('search-sidebar');
            sidebar.classList.toggle('show');
        }

        function renderDetails(container, id) {
            const p = state.properties.find(item => item.id === id);
            if (!p) {
                container.innerHTML = '<div class="p-20 text-center">Property not found.</div>';
                return;
            }

            container.innerHTML = `
                <div class="max-w-7xl details-container animate-fade">
                    <div class="breadcrumb">
                        <span onclick="router.navigate('#/')">Home</span> / 
                        <span onclick="router.navigate('#/search?type=${p.type}')">${p.type}s</span> / 
                        <strong>${p.title}</strong>
                    </div>

                    <div class="gallery-grid">
                        <div class="main-image" onclick="openLightbox(document.getElementById('detail-main-img').src)">
                            <img id="detail-main-img" src="${p.images[0]}" alt="${p.title}">
                            <div class="zoom-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 3h6m0 0v6m0-6L14 10M9 21H3m0 0v-6m0 6l7-7" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </div>
                        </div>
                        <div class="thumb-list no-scrollbar">
                            ${p.images.map((img, i) => `
                                <div class="thumb-item ${i === 0 ? 'active' : ''}" onclick="updateDetailImage(this, '${img}')">
                                    <img src="${img}">
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="details-content">
                        <div class="info-card">
                            <div class="info-header">
                                <div class="info-title">
                                    <span class="badge" style="margin-bottom: 12px; display: inline-block;">${p.type}</span>
                                    <h1>${p.title}</h1>
                                    <p class="card-location" style="margin-top: 15px">
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                                        ${p.location}
                                    </p>
                                </div>
                                <div class="info-price">
                                    <h2>${formatCurrency(p.price)}</h2>
                                    <p class="card-area">Market Rate</p>
                                </div>
                            </div>

                            <div class="stats-grid">
                                <div class="stat-item"><p>Total Area</p><h4>${p.area} sq.ft</h4></div>
                                <div class="stat-item"><p>Status</p><h4>${p.possessionDate || 'Immediate'}</h4></div>
                                <div class="stat-item"><p>Asset ID</p><h4>${p.id.split('-').pop()}</h4></div>
                                <div class="stat-item"><p>City</p><h4>${p.city}</h4></div>
                            </div>

                            <div style="margin-top: 40px">
                                <h3 style="font-weight: 800; margin-bottom: 15px; font-style: italic;">Description</h3>
                                <p style="color: var(--medium-gray); line-height: 1.8; font-size: 15px;">${p.description}</p>
                            </div>

                            <div style="margin-top: 40px">
                                <h3 style="font-weight: 800; margin-bottom: 20px; font-style: italic;">Amenities</h3>
                                <div class="amenities-grid">
                                    ${p.amenities ? p.amenities.map(a => `
                                        <div class="amenity-item"><span class="amenity-dot"></span>${a}</div>
                                    `).join('') : '<p>Standard Residential Amenities</p>'}
                                </div>
                            </div>
                        </div>

                        <div class="cta-sidebar">
                            <div class="builder-card animate-fade">
                                <div class="builder-info">
                                    <div class="builder-logo">${(p.builder || 'N').charAt(0)}</div>
                                    <div>
                                        <p style="font-size: 8px; font-weight: 800; color: var(--brand-orange); text-transform: uppercase; letter-spacing: 1px;">Top-rated Builder</p>
                                        <h4 style="font-weight: 800; font-size: 20px;">${p.builder || 'Nestjen Partner'}</h4>
                                    </div>
                                </div>
                                <button class="whatsapp-btn" onclick="openWhatsApp('${p.title}', '${p.location}', '${formatCurrency(p.price)}')">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.246 2.248 3.484 5.232 3.484 8.412-.003 6.557-5.338 11.892-11.893 11.892-1.997-.001-3.951-.5-5.688-1.448l-6.309 1.656zm6.224-3.52c1.541.951 3.278 1.454 5.051 1.455h.001c5.51 0 9.991-4.482 9.994-9.995 0-2.671-1.04-5.181-2.93-7.071-1.889-1.891-4.398-2.932-7.068-2.932-5.509 0-9.99 4.482-9.994 9.994-.001 2.014.569 3.967 1.647 5.676l-.427 1.558 1.758-.461zm11.734-6.87c-.311-.156-1.845-.91-2.134-1.014-.289-.104-.499-.156-.708.156-.208.312-.807 1.014-.988 1.221-.181.208-.363.234-.674.078-.311-.156-1.316-.484-2.504-1.544-.925-.824-1.548-1.841-1.73-2.152-.181-.312-.019-.481.136-.636.14-.139.311-.363.466-.545.156-.181.208-.312.311-.519.104-.208.052-.389-.026-.545-.078-.156-.708-1.714-.971-2.338-.256-.608-.517-.525-.708-.535l-.604-.011c-.208 0-.547.078-.833.389-.286.312-1.092 1.066-1.092 2.6s1.117 3.012 1.274 3.22c.156.208 2.199 3.359 5.328 4.71.744.322 1.325.515 1.777.659.747.237 1.427.203 1.965.123.599-.089 1.845-.754 2.107-1.442.263-.688.263-1.273.184-1.396-.078-.124-.289-.208-.6-.363z"/></svg>
                                    Chat with Owner
                                </button>
                                <button class="inquiry-btn" onclick="openInquiryModal('${p.title}', '${p.id}', '${p.type}', '${formatCurrency(p.price)}')">Send Inquiry</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function openLightbox(src) {
    const lightbox = document.getElementById('lightbox');
    const img = document.getElementById('lightbox-img');
    img.src = src;
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.remove('active');
    document.body.style.overflow = 'auto';
}

function applyFilter(key, val) {
    const hash = window.location.hash || '#/search';
    const [base, query] = hash.split('?');
    const params = new URLSearchParams(query || '');
    params.set(key, val);
    router.navigate(`${base}?${params.toString()}`);
}

function updateDetailImage(el, src) {
    document.getElementById('detail-main-img').src = src;
    document.querySelectorAll('.thumb-item').forEach(item => item.classList.remove('active'));
    el.classList.add('active');
}

function toggleSave(e, id) {
    e.stopPropagation();
    if (state.savedIds.includes(id)) {
        state.savedIds = state.savedIds.filter(i => i !== id);
    } else {
        state.savedIds.push(id);
    }
    localStorage.setItem('savedProperties', JSON.stringify(state.savedIds));
    const btn = e.currentTarget;
    btn.classList.toggle('active');
    const svg = btn.querySelector('svg');
    if (btn.classList.contains('active')) svg.setAttribute('fill', 'currentColor');
    else svg.setAttribute('fill', 'none');
}

function openWhatsApp(title, location, price) {
    const phone = "9173213576";
    const text = encodeURIComponent(`Hi, I'm interested in ${title} at ${location}. Price: ${price}.`);
    window.open(`https://wa.me/${phone}?text=${text}`, '_blank');
}

const modalContainer = document.getElementById('modal-container');

function closeModal() {
    modalContainer.classList.remove('active');
    modalContainer.innerHTML = '';
}

let authPhotoBase64 = "";

function openLoginModal(isRegister = false) {
    authPhotoBase64 = "";
    modalContainer.innerHTML = `
        <div class="modal-card animate-fade">
            <button class="close-modal" onclick="closeModal()"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="3" stroke-linecap="round"/></svg></button>
            
            <div class="auth-tabs">
                <button class="auth-tab ${isRegister ? 'active' : ''}" onclick="openLoginModal(true)">Register</button>
                <button class="auth-tab ${!isRegister ? 'active' : ''}" onclick="openLoginModal(false)">Login</button>
            </div>

            ${isRegister ? `
                <div class="profile-picker-container">
                    <div class="profile-picker">
                        <img id="auth-pic-preview" src="" class="hidden">
                        <svg id="auth-pic-placeholder" viewBox="0 0 24 24" fill="currentColor" style="width: 50px; height: 50px; color: #FFE0D6;"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                    <label class="camera-btn">
                        <input type="file" accept="image/*" class="hidden" onchange="handleAuthPhoto(this)">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    </label>
                </div>
            ` : `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="font-size: 32px; font-weight: 800; font-style: italic;">Welcome back.</h2>
                    <p style="font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--brand-orange); margin-top: 10px;">Login to continue</p>
                </div>
            `}

            <form id="auth-form">
                ${isRegister ? `
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="a-name" class="form-input" placeholder="Your Name" required>
                    </div>
                ` : ''}
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="a-email" class="form-input" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="a-pass" class="form-input" placeholder="••••••••" required>
                </div>
                ${isRegister ? `
                    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Phone</label>
                            <input type="tel" id="a-phone" class="form-input" placeholder="10 Digits" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Date of Birth</label>
                            <input type="date" id="a-dob" class="form-input" required>
                        </div>
                    </div>
                ` : ''}
                <button type="submit" class="form-submit" id="auth-submit-btn">${isRegister ? 'Join Nestjen' : 'Sign In'}</button>
            </form>
        </div>
    `;
    modalContainer.classList.add('active');

    document.getElementById('auth-form').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('auth-submit-btn');
        const email = document.getElementById('a-email').value.trim();
        const pass = document.getElementById('a-pass').value.trim();
        
        btn.innerText = 'Signing you in...';
        btn.disabled = true;

        if (isRegister) {
            const newUser = { 
                name: document.getElementById('a-name').value, 
                email: email, 
                phone: document.getElementById('a-phone').value, 
                password: pass, 
                dob: document.getElementById('a-dob').value,
                photo: authPhotoBase64
            };
            
            try {
                await fetch(GAS_WEBAPP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ action: 'sync_user', user: newUser })
                });
                state.user = newUser;
                localStorage.setItem('estate_user', JSON.stringify(newUser));
                closeModal();
                updateNavActions();
                router.refresh();
            } catch (err) {
                alert('Connection error. Please try again.');
                btn.innerText = 'Join Nestjen';
                btn.disabled = false;
            }
        } else {
            try {
                const resp = await fetch(`${GAS_WEBAPP_URL}?action=verify_user&email=${encodeURIComponent(email)}&password=${encodeURIComponent(pass)}`);
                const result = await resp.json();
                
                if (result.status === 'success') {
                    state.user = result.user;
                    localStorage.setItem('estate_user', JSON.stringify(result.user));
                    closeModal();
                    updateNavActions();
                    router.refresh();
                } else {
                    alert(result.message || "Invalid Email or Password.");
                    btn.innerText = 'Sign In';
                    btn.disabled = false;
                }
            } catch (err) {
                alert('Connection error. Please check your internet.');
                btn.innerText = 'Sign In';
                btn.disabled = false;
            }
        }
    };
}

function handleAuthPhoto(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
            authPhotoBase64 = e.target.result;
            const preview = document.getElementById('auth-pic-preview');
            const placeholder = document.getElementById('auth-pic-placeholder');
            preview.src = e.target.result;
            preview.classList.remove('hidden');
            placeholder.classList.add('hidden');
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function openProfileModal() {
    modalContainer.innerHTML = `
        <div class="modal-card animate-fade profile-portal-wrapper">
            <button class="close-modal" onclick="closeModal()" style="color: white"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="3" stroke-linecap="round"/></svg></button>
            <div class="profile-header">
                <h2>Account.</h2>
                <img src="${state.user.photo || 'https://picsum.photos/200/200'}" class="profile-avatar-large">
            </div>
            <div class="profile-content">
                <div class="profile-user-meta">
                    <h3>${state.user.name}</h3>
                    <p>Verified Member</p>
                </div>
                
                <div class="profile-stats-grid">
                    <div class="profile-stat-box">
                        <label>Postings</label>
                        <span>0</span>
                    </div>
                    <div class="profile-stat-box">
                        <label>Favorites</label>
                        <span>${state.savedIds.length}</span>
                    </div>
                </div>

                <button class="form-submit" style="background: var(--dark-gray); margin-bottom: 25px" onclick="openAddListingModal()">List a Property</button>
                
                <div class="pending-list" id="pending-container">
                    ${state.pendingRequests.length > 0 ? state.pendingRequests.map(r => `
                        <div class="pending-card">
                            <h5>${r.title}</h5>
                            <div class="pending-progress"><div class="pending-progress-bar"></div></div>
                            <p style="font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); opacity: 0.6">Reviewing listing...</p>
                        </div>
                    `).join('') : `
                        <div class="pending-card">
                            <h5>Welcome to Nestjen</h5>
                            <div class="pending-progress"><div class="pending-progress-bar" style="width: 100%"></div></div>
                            <p style="font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); opacity: 0.6">Profile Complete</p>
                        </div>
                    `}
                </div>

                <button onclick="handleLogout()" class="sign-out-btn">Log Out</button>
            </div>
        </div>
    `;
    modalContainer.classList.add('active');
}

function handleLogout() {
    state.user = null;
    localStorage.removeItem('estate_user');
    closeModal();
    updateNavActions();
    router.navigate('#/');
}

let tempListingImages = [];
function openAddListingModal() {
    tempListingImages = [];
    modalContainer.innerHTML = `
        <div class="modal-card animate-fade" style="max-width: 650px">
            <button class="close-modal" onclick="closeModal()"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="3" stroke-linecap="round"/></svg></button>
            <div style="margin-bottom: 30px;">
                <h2 style="font-size: 32px; font-weight: 800; font-style: italic;">Post a listing.</h2>
                <p style="font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--brand-orange); margin-top: 10px;">Prepare your listing details</p>
            </div>
            <form id="listing-form">
                <div class="form-group">
                    <label>Photos (Min 4)</label>
                    <div class="image-uploader-grid" id="listing-img-grid">
                        <label class="image-uploader-box">
                            <input type="file" multiple accept="image/*" class="hidden" onchange="handleListingUpload(this)">
                            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="3" stroke-linecap="round"/></svg>
                            <span style="font-size: 8px; font-weight: 800; text-transform: uppercase; margin-top: 5px;">Add Photos</span>
                        </label>
                    </div>
                </div>
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Property Title</label>
                        <input type="text" id="l-title" class="form-input" placeholder="e.g. Modern 3BHK Apartment" required>
                    </div>
                    <div class="form-group">
                        <label>Property Type</label>
                        <select id="l-type" class="filter-select" style="width: 100%; border: none; background: var(--soft-peach); padding: 15px 20px; border-radius: 18px; font-weight: 700;">
                            <option value="Flat">Flat</option>
                            <option value="Shop">Shop</option>
                            <option value="Plot">Plot</option>
                            <option value="Office">Office</option>
                        </select>
                    </div>
                </div>
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Price (₹)</label>
                        <input type="number" id="l-price" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Area (sq.ft)</label>
                        <input type="number" id="l-area" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="l-location" class="form-input" placeholder="e.g. Satellite, Ahmedabad" required>
                </div>
                <button type="submit" class="form-submit" id="listing-submit-btn">Submit Property Listing</button>
            </form>
        </div>
    `;
    modalContainer.classList.add('active');

    document.getElementById('listing-form').onsubmit = (e) => {
        e.preventDefault();
        if (tempListingImages.length < 4) { alert('Please upload at least 4 photos.'); return; }
        const newReq = {
            id: 'prop-' + Date.now(),
            title: document.getElementById('l-title').value,
            type: document.getElementById('l-type').value,
            price: document.getElementById('l-price').value,
            area: document.getElementById('l-area').value,
            location: document.getElementById('l-location').value,
            images: tempListingImages
        };
        state.pendingRequests.push(newReq);
        closeModal();
        openProfileModal();
        fetch(GAS_WEBAPP_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({ action: 'add_listing_request', property: newReq })
        }).catch(err => console.error("Submit failed", err));
    };
}

function handleListingUpload(input) {
    const files = input.files;
    if (!files) return;
    Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
            tempListingImages.push(e.target.result);
            renderListingImages();
        };
        reader.readAsDataURL(file);
    });
}

function renderListingImages() {
    const grid = document.getElementById('listing-img-grid');
    if (!grid) return;
    const uploadBtn = grid.querySelector('label');
    grid.innerHTML = '';
    tempListingImages.forEach((src, i) => {
        const box = document.createElement('div');
        box.className = 'uploaded-img-box';
        box.innerHTML = `<img src="${src}"><button class="remove-img-btn" onclick="removeTempImg(${i})">×</button>`;
        grid.appendChild(box);
    });
    if (tempListingImages.length < 8 && uploadBtn) grid.appendChild(uploadBtn);
}

function removeTempImg(i) {
    tempListingImages.splice(i, 1);
    renderListingImages();
}

function openInquiryModal(title, id, type, price) {
    modalContainer.innerHTML = `
        <div class="modal-card animate-fade">
            <button class="close-modal" onclick="closeModal()"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="3" stroke-linecap="round"/></svg></button>
            <div style="margin-bottom: 30px;">
                <h2 style="font-size: 32px; font-weight: 800; font-style: italic;">Ask about this property.</h2>
                <p style="font-size: 9px; font-weight: 800; color: var(--brand-orange); text-transform: uppercase; margin-top: 10px;">${title}</p>
            </div>
            <form id="inquiry-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="i-name" class="form-input" value="${state.user?.name || ''}" required>
                </div>
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="i-phone" class="form-input" value="${state.user?.phone || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="i-email" class="form-input" value="${state.user?.email || ''}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Message</label>
                    <textarea id="i-msg" class="form-input" style="height: 100px; resize: none" placeholder="Tell the owner why you are interested..."></textarea>
                </div>
                <button type="submit" class="form-submit" id="inquiry-submit-btn">Send Inquiry</button>
            </form>
        </div>
    `;
    modalContainer.classList.add('active');
    document.getElementById('inquiry-form').onsubmit = (e) => {
        e.preventDefault();
        const inquiryData = { 
            action: 'submit_inquiry',
            propertyName: title,
            propertyId: id,
            propertyType: type,
            propertyPrice: price,
            userName: document.getElementById('i-name').value,
            userPhone: document.getElementById('i-phone').value,
            userEmail: document.getElementById('i-email').value,
            message: document.getElementById('i-msg').value
        };
        modalContainer.innerHTML = `
            <div class="modal-card animate-fade text-center">
                <div style="width: 80px; height: 80px; background: #e6ffed; color: #2ecc71; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px;">
                    <svg width="40" height="40" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                </div>
                <h2 style="font-size: 32px; font-weight: 800; font-style: italic;">Sent!</h2>
                <p style="font-size: 9px; font-weight: 800; color: var(--medium-gray); text-transform: uppercase; margin-top: 10px;">Your inquiry has been sent to the owner.</p>
                <button class="form-submit" style="margin-top: 30px;" onclick="closeModal()">Back to Listings</button>
            </div>
        `;
        fetch(GAS_WEBAPP_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(inquiryData)
        }).catch(err => console.error("Send failed", err));
    };
}

// Init
window.addEventListener('hashchange', () => router.handleHashChange());
window.addEventListener('scroll', () => {
    const nav = document.getElementById('navbar');
    nav.classList.toggle('scrolled', window.scrollY > 20);
});
document.getElementById('global-search-form').onsubmit = (e) => {
    e.preventDefault();
    const val = document.getElementById('global-search-input').value;
    router.navigate(`#/search?q=${encodeURIComponent(val)}`);
};
document.getElementById('mobile-search-input').onkeyup = (e) => {
    if (e.key === 'Enter') {
        router.navigate(`#/search?q=${encodeURIComponent(e.target.value)}`);
    }
};
document.getElementById('mobile-profile-btn').onclick = () => {
    if (state.user) openProfileModal();
    else openLoginModal(false);
};

// Start Up
fetchMarketplace();
setInterval(syncPrivateStatus, 30000);
router.handleHashChange();
</script>
</body>
</html>
