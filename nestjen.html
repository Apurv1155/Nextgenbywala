<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nestjen | Modern Property Marketplace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-orange: #FF7043;
            --brand-orange-hover: #F4511E;
            --soft-peach: #FFF9F7;
            --warm-white: #FFFFFF;
            --dark-gray: #2D3436;
            --medium-gray: #636E72;
            --light-gray: #EDF2F4;
            --border-color: rgba(0, 0, 0, 0.06);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-subtle: 0 10px 30px rgba(0, 0, 0, 0.04);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--soft-peach);
            color: var(--dark-gray);
            line-height: 1.6;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--soft-peach); }
        ::-webkit-scrollbar-thumb { background: #DDD; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--brand-orange); }

        /* Helpers */
        .max-w-7xl { max-width: 1280px; margin: 0 auto; padding: 0 24px; }
        .glass { background: var(--glass-bg); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none !important; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }
        .font-black { font-weight: 800; }
        .font-bold { font-weight: 600; }
        .uppercase { text-transform: uppercase; }
        .italic { font-style: italic; }
        .tracking-widest { letter-spacing: 0.08em; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }

        /* Loader */
        #global-loader {
            position: fixed; inset: 0; z-index: 9999; background: #FFF;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.4s;
        }
        .spinner {
            width: 36px; height: 36px; border: 3px solid var(--light-gray);
            border-top-color: var(--brand-orange); border-radius: 50%; animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Navigation */
        nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; transition: var(--transition-smooth); padding: 24px 0; }
        nav.scrolled { padding: 12px 0; }
        .nav-container { height: 68px; border-radius: 34px; padding: 0 24px; display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--border-color); box-shadow: var(--shadow-subtle); }
        .logo { display: flex; align-items: center; cursor: pointer; text-decoration: none; color: inherit; }
        .logo-icon { width: 38px; height: 38px; background: var(--brand-orange); border-radius: 12px; margin-right: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .logo-text { font-size: 22px; font-weight: 800; letter-spacing: -1px; }
        .logo-text span { color: var(--brand-orange); }

        .search-bar { flex: 1; max-width: 380px; margin: 0 24px; position: relative; }
        .search-bar input { width: 100%; background: #F8F9FA; border: 1px solid transparent; padding: 10px 16px 10px 42px; border-radius: 18px; font-weight: 500; font-size: 14px; outline: none; transition: 0.2s; }
        .search-bar input:focus { background: white; border-color: var(--brand-orange); box-shadow: 0 0 0 4px rgba(255, 112, 67, 0.05); }
        .search-bar svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--brand-orange); width: 16px; pointer-events: none; }

        .nav-links { display: flex; gap: 24px; align-items: center; }
        .nav-links button { background: none; border: none; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--medium-gray); cursor: pointer; transition: color 0.2s; }
        .nav-links button:hover { color: var(--brand-orange); }

        .auth-btn { background: var(--brand-orange); color: white; border: none; padding: 10px 22px; border-radius: 16px; font-size: 11px; font-weight: 800; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        .auth-btn:hover { background: var(--brand-orange-hover); transform: translateY(-1px); }

        .user-profile-badge { display: flex; align-items: center; gap: 10px; background: white; padding: 4px 14px 4px 4px; border-radius: 20px; cursor: pointer; border: 1px solid var(--border-color); transition: 0.2s; }
        .user-profile-badge:hover { border-color: var(--brand-orange); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .user-avatar { width: 34px; height: 34px; border-radius: 14px; object-fit: cover; }
        .user-info p { font-size: 7px; font-weight: 800; text-transform: uppercase; color: var(--brand-orange); line-height: 1; margin-bottom: 2px; }
        .user-info h4 { font-size: 11px; font-weight: 700; line-height: 1; }

        /* Mobile Bottom Nav */
        .mobile-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 1000; height: 72px; border-radius: 36px; display: flex; justify-content: space-around; align-items: center; padding: 0 8px; display: none; box-shadow: 0 15px 40px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.8); }
        .mobile-nav-item { display: flex; flex-direction: column; align-items: center; color: var(--medium-gray); text-decoration: none; gap: 4px; font-size: 8px; font-weight: 700; text-transform: uppercase; }
        .mobile-nav-item.active { color: var(--brand-orange); }
        .mobile-nav-item svg { width: 22px; height: 22px; }

        /* Mobile Floating Search Bar */
        .mobile-floating-search {
            position: fixed; bottom: 105px; left: 20px; right: 20px; z-index: 999;
            background: white; border: 1px solid var(--border-color);
            border-radius: 24px; padding: 4px; display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .mobile-floating-search input { width: 100%; background: var(--soft-peach); border: none; padding: 12px 12px 12px 42px; border-radius: 20px; font-weight: 600; font-size: 14px; outline: none; }
        .mobile-floating-search svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--brand-orange); width: 16px; }

        /* Hero */
        .hero { margin-top: 100px; margin-bottom: 50px; height: 500px; border-radius: 44px; overflow: hidden; position: relative; }
        .hero-slide { position: absolute; inset: 0; background-size: cover; background-position: center; transition: opacity 1s; opacity: 0; }
        .hero-slide.active { opacity: 1; }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 70%); display: flex; flex-direction: column; justify-content: flex-end; padding: 60px; }
        .hero-content { color: white; max-width: 650px; }
        .hero-content h1 { font-size: 60px; font-weight: 800; line-height: 1; margin-bottom: 20px; letter-spacing: -3px; }
        .hero-content h1 span { color: var(--brand-orange); font-style: italic; }
        .hero-content p { color: rgba(255,255,255,0.9); font-size: 16px; margin-bottom: 30px; font-weight: 400; }
        .hero-btn { background: white; color: var(--dark-gray); border: none; padding: 18px 36px; border-radius: 20px; font-weight: 800; font-size: 11px; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        .hero-btn:hover { background: var(--brand-orange); color: white; transform: translateY(-2px); }

        /* Property Grid */
        .section-header { margin-bottom: 36px; }
        .section-title h2 { font-size: 40px; font-weight: 800; font-style: italic; letter-spacing: -2px; }
        .section-title h2 span { color: var(--brand-orange); }
        .section-title p { font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); margin-top: 6px; letter-spacing: 2px; }

        .property-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(290px, 1fr)); gap: 24px; }
        .property-card { background: white; border-radius: 32px; overflow: hidden; transition: var(--transition-smooth); border: 1px solid var(--border-color); cursor: pointer; display: flex; flex-direction: column; }
        .property-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.06); border-color: rgba(255, 112, 67, 0.2); }
        .card-image { position: relative; aspect-ratio: 4/3; overflow: hidden; }
        .card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s ease; }
        .property-card:hover .card-image img { transform: scale(1.08); }
        .card-badges { position: absolute; top: 16px; left: 16px; display: flex; gap: 6px; }
        .badge { background: var(--brand-orange); color: white; font-size: 9px; font-weight: 800; padding: 6px 12px; border-radius: 20px; text-transform: uppercase; }
        .badge-white { background: white; color: var(--brand-orange); }
        .save-btn { position: absolute; top: 16px; right: 16px; width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.9); border: none; display: flex; align-items: center; justify-content: center; color: var(--medium-gray); transition: 0.2s; cursor: pointer; }
        .save-btn.active { color: var(--brand-orange); }
        .card-body { padding: 24px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 18px; font-weight: 700; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-location { font-size: 11px; font-weight: 500; color: var(--medium-gray); display: flex; align-items: center; gap: 4px; margin-bottom: 20px; }
        .card-location svg { width: 12px; color: var(--brand-orange); }
        .card-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; }
        .card-price { font-size: 22px; font-weight: 800; color: var(--brand-orange); }
        .card-area { font-size: 9px; font-weight: 700; color: var(--medium-gray); text-transform: uppercase; margin-top: 2px; }
        .card-arrow { width: 36px; height: 36px; border-radius: 12px; background: var(--light-gray); display: flex; align-items: center; justify-content: center; color: var(--medium-gray); transition: 0.3s; }
        .property-card:hover .card-arrow { background: var(--brand-orange); color: white; }

        /* Search Page Filters */
        .search-container { display: flex; gap: 32px; margin-top: 100px; padding-bottom: 80px; }
        .sidebar { width: 300px; flex-shrink: 0; position: sticky; top: 100px; height: fit-content; background: white; border-radius: 36px; padding: 32px; border: 1px solid var(--border-color); box-shadow: var(--shadow-subtle); }
        .filter-group { margin-bottom: 28px; }
        .filter-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); letter-spacing: 1px; margin-bottom: 12px; display: block; }
        .filter-select { width: 100%; padding: 12px 16px; border-radius: 14px; border: 1px solid var(--light-gray); font-weight: 600; font-size: 13px; outline: none; appearance: none; background: #FAFBFC; cursor: pointer; }
        .filter-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .filter-btn { padding: 10px; border-radius: 12px; border: 1px solid var(--light-gray); background: white; font-weight: 700; font-size: 10px; text-transform: uppercase; cursor: pointer; transition: 0.2s; color: var(--medium-gray); }
        .filter-btn.active { background: var(--brand-orange); border-color: var(--brand-orange); color: white; }

        .mobile-filter-trigger {
            display: none; width: 100%; background: white; border: 1px solid var(--border-color); color: var(--dark-gray); padding: 14px; border-radius: 20px; font-weight: 700; text-transform: uppercase; font-size: 11px; margin-bottom: 16px; align-items: center; justify-content: center; gap: 8px; cursor: pointer;
        }

        /* Property Details */
        .details-container { padding-top: 90px; padding-bottom: 100px; }
        .breadcrumb { font-size: 11px; color: var(--medium-gray); margin-bottom: 24px; font-weight: 500; }
        .breadcrumb strong { color: var(--dark-gray); font-weight: 700; }
        
        .gallery-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 36px; }
        .main-image { border-radius: 36px; overflow: hidden; aspect-ratio: 16/9; cursor: pointer; position: relative; border: 1px solid var(--border-color); }
        .main-image img { width: 100%; height: 100%; object-fit: cover; }
        .main-image .zoom-icon { position: absolute; bottom: 20px; right: 20px; background: rgba(255,255,255,0.9); color: var(--brand-orange); width: 42px; height: 42px; border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .thumb-list { display: flex; flex-direction: column; gap: 12px; overflow-y: auto; max-height: 480px; padding-right: 4px; }
        .thumb-item { border-radius: 20px; overflow: hidden; aspect-ratio: 4/3; cursor: pointer; border: 2px solid transparent; transition: 0.2s; flex-shrink: 0; background: var(--light-gray); }
        .thumb-item.active { border-color: var(--brand-orange); }
        .thumb-item img { width: 100%; height: 100%; object-fit: cover; }

        .details-content { display: grid; grid-template-columns: 1.8fr 1.2fr; gap: 32px; }
        .info-card { background: white; border-radius: 36px; padding: 40px; margin-bottom: 24px; border: 1px solid var(--border-color); }
        .info-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 28px; }
        .info-title h1 { font-size: 34px; font-weight: 800; letter-spacing: -1.5px; line-height: 1.1; color: var(--dark-gray); }
        .info-price { text-align: right; }
        .info-price h2 { font-size: 36px; font-weight: 800; color: var(--brand-orange); letter-spacing: -1px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; padding: 28px 0; border-top: 1px solid var(--light-gray); border-bottom: 1px solid var(--light-gray); margin: 28px 0; }
        .stat-item p { font-size: 9px; font-weight: 700; text-transform: uppercase; color: var(--medium-gray); margin-bottom: 4px; letter-spacing: 0.5px; }
        .stat-item h4 { font-size: 15px; font-weight: 700; }
        
        .amenities-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
        .amenity-item { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: var(--medium-gray); }
        .amenity-dot { width: 6px; height: 6px; background: var(--brand-orange); border-radius: 50%; opacity: 0.6; }

        /* CTA Sidebar */
        .cta-sidebar { position: sticky; top: 100px; height: fit-content; }
        .builder-card { background: white; border-radius: 36px; padding: 32px; border: 1px solid var(--border-color); box-shadow: var(--shadow-subtle); }
        .builder-info { display: flex; align-items: center; gap: 14px; margin-bottom: 28px; }
        .builder-logo { width: 56px; height: 56px; border-radius: 16px; background: var(--light-gray); color: var(--brand-orange); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 800; }
        .whatsapp-btn { width: 100%; background: #25D366; color: white; border: none; padding: 18px; border-radius: 18px; font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: 0.2s; margin-bottom: 12px; }
        .whatsapp-btn:hover { background: #128C7E; transform: translateY(-2px); }
        .inquiry-btn { width: 100%; background: white; border: 1.5px solid var(--brand-orange); color: var(--brand-orange); padding: 18px; border-radius: 18px; font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; transition: 0.2s; }
        .inquiry-btn:hover { background: var(--soft-peach); transform: translateY(-2px); }

        /* Modals */
        .modal-overlay { position: fixed; inset: 0; z-index: 3000; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; padding: 20px; display: none; }
        .modal-overlay.active { display: flex; }
        .modal-card { background: white; border-radius: 40px; width: 100%; max-width: 480px; padding: 44px; position: relative; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border-color); }
        .modal-card::-webkit-scrollbar { display: none; }
        .close-modal { position: absolute; top: 24px; right: 24px; border: none; background: #F3F4F6; color: var(--medium-gray); cursor: pointer; padding: 8px; border-radius: 12px; transition: 0.2s; }
        .close-modal:hover { background: var(--brand-orange); color: white; }
        
        .auth-tabs { display: flex; background: var(--light-gray); border-radius: 16px; padding: 4px; margin-bottom: 32px; }
        .auth-tab { flex: 1; border: none; background: none; padding: 12px; border-radius: 12px; font-weight: 800; font-size: 10px; text-transform: uppercase; cursor: pointer; color: var(--medium-gray); }
        .auth-tab.active { background: white; color: var(--brand-orange); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        .image-uploader-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .image-uploader-box, .uploaded-img-box {
            aspect-ratio: 1/1; border-radius: 14px; border: 1.5px dashed var(--light-gray);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; position: relative; background: #FAFAFA; overflow: hidden; transition: 0.2s;
        }
        .image-uploader-box:hover { border-color: var(--brand-orange); background: white; }
        .uploaded-img-box { border-style: solid; border-color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .uploaded-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .remove-img-btn {
            position: absolute; top: 4px; right: 4px;
            background: rgba(239, 68, 68, 0.9); color: white;
            border: none; border-radius: 50%; width: 20px; height: 20px;
            cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center;
        }

        .profile-picker-container { position: relative; width: 120px; height: 120px; margin: 0 auto 32px; }
        .profile-picker { width: 100%; height: 100%; border-radius: 50%; background: var(--light-gray); border: 4px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .profile-picker img { width: 100%; height: 100%; object-fit: cover; }
        .camera-btn { position: absolute; bottom: 0; right: 0; background: var(--brand-orange); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; border: 3px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

        .form-group { margin-bottom: 20px; }
        .form-group label { font-size: 9px; font-weight: 800; text-transform: uppercase; color: var(--medium-gray); margin-bottom: 8px; display: block; letter-spacing: 0.5px; }
        .form-input { width: 100%; background: #F9FAFB; border: 1px solid var(--light-gray); border-radius: 14px; padding: 14px 18px; font-weight: 600; font-size: 13px; outline: none; transition: 0.2s; font-family: inherit; }
        .form-input:focus { border-color: var(--brand-orange); background: white; }
        .form-submit { width: 100%; background: var(--dark-gray); color: white; border: none; padding: 18px; border-radius: 16px; font-weight: 800; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; cursor: pointer; margin-top: 8px; transition: 0.2s; }
        .form-submit:hover { background: var(--brand-orange); transform: translateY(-2px); }

        /* Profile Specifics */
        .profile-header { height: 140px; background: #F3F4F6; border-radius: 32px 32px 0 0; margin: -44px -44px 0 -44px; display: flex; align-items: flex-end; padding: 32px; position: relative; }
        .profile-header h2 { font-size: 28px; font-weight: 800; color: var(--dark-gray); }
        .profile-avatar-large { width: 90px; height: 90px; border-radius: 28px; border: 4px solid white; position: absolute; bottom: -45px; right: 32px; background: #EEE; object-fit: cover; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
        .profile-content { padding-top: 36px; }
        .profile-stat-bar { display: flex; gap: 12px; margin: 28px 0; }
        .profile-stat-box { flex: 1; background: #F9FAFB; padding: 18px; border-radius: 20px; text-align: center; border: 1px solid var(--light-gray); }
        .profile-stat-box p { font-size: 8px; font-weight: 800; text-transform: uppercase; color: var(--brand-orange); margin-bottom: 4px; }
        .profile-stat-box h3 { font-size: 24px; font-weight: 800; }

        /* Lightbox */
        .lightbox-overlay { position: fixed; inset: 0; z-index: 4000; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; padding: 20px; display: none; }
        .lightbox-overlay.active { display: flex; }
        .lightbox-img { max-width: 100%; max-height: 85vh; border-radius: 12px; }
        .lightbox-close { position: absolute; top: 20px; right: 20px; color: white; background: rgba(255,255,255,0.1); border: none; cursor: pointer; width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* Responsive Breakpoints */
        @media (max-width: 1024px) {
            .hero-content h1 { font-size: 48px; }
            .details-content { grid-template-columns: 1fr; }
            .gallery-grid { grid-template-columns: 1fr; }
            .thumb-list { flex-direction: row; max-height: none; overflow-x: auto; padding-right: 0; padding-bottom: 8px; }
            .thumb-item { width: 110px; }
        }

        @media (max-width: 768px) {
            nav { padding: 16px 0; }
            .nav-links, .search-bar { display: none; }
            .mobile-nav { display: flex; }
            .hero { height: 380px; border-radius: 32px; margin-top: 85px; }
            .hero-overlay { padding: 24px; }
            .hero-content h1 { font-size: 38px; }
            .section-title h2 { font-size: 30px; }
            .search-container { flex-direction: column; gap: 0px; margin-top: 85px; }
            .sidebar { 
                width: 100%; position: relative; top: 0; padding: 0px; max-height: 0; overflow: hidden; opacity: 0; margin-top: 0; border-radius: 32px; box-shadow: none; border: none; pointer-events: none; transition: var(--transition-smooth);
            }
            .sidebar.show {
                max-height: 1200px; opacity: 1; margin-top: 10px; margin-bottom: 24px; padding: 24px; background: white; border: 1px solid var(--border-color); pointer-events: auto;
            }
            .sidebar .section-title { display: none; }
            .mobile-filter-trigger { display: flex; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
            .modal-card { padding: 32px; border-radius: 36px; }
            .info-card { padding: 28px; }
            .info-title h1 { font-size: 26px; }
            .info-price h2 { font-size: 28px; margin-top: 4px; }
            .info-header { flex-direction: column; align-items: flex-start; }
            .info-price { text-align: left; }
            .mobile-floating-search { display: block; }
            .property-grid { grid-template-columns: 1fr; }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="no-scrollbar">

    <div id="global-loader">
        <div class="spinner"></div>
        <p style="margin-top: 16px; font-weight: 700; color: var(--medium-gray); font-size: 9px; text-transform: uppercase; letter-spacing: 2px;">Syncing Node...</p>
    </div>

    <nav id="navbar">
        <div class="max-w-7xl">
            <div class="nav-container glass">
                <a href="#/" class="logo">
                    <div class="logo-icon">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAABVlBMVEX///8AAAD/zWmAtv+gyP//fZcbGxuJ34//0WsyMjKDuv/5+fn/02z/z2qyj0mBuP+lzv/x8fHr6+uEvP9kfZ+wsLAiIiL/gZwZGRmo0v+ggUJsbGybm5v5yGeFvv+VlZUyKBXa2tpWVla6urrk5ORRc6F5rPEOFBxfX196enqrVGWhoaFAQEBMTExwWi7HoFJunNuKiooQEBDkt14oKCh7YzPExMTwwWPar1pRQSFyouM7VHVolNBHOR1gicBBUmiWvO8zSWbkcIeKbzm8l01fTCdNbpolNEkWHyxFYomDpNEbFQuJq9orIhJZf7IqPFRKJCwiERRYkFx6x4BoqWxKXXdacZAuOkpzkLc6MiT/36T/9+jOu5koOVFRZoKmhUT/7s//47D/1H+hmo0jLDh4O0eVSVjWaX85HCE4WzpMe08sSC4fMyE/Z0Jko2m/XnGLRFJ1v3qQrBkXAAAPPklEQVR4nO2d+1fbRhbHLWRA2FKwcQIkxDyNwRAwjyR2MKEYSMAhMW3aNNnNtuwjTbbZtkn+/19Wsqx5aGak0WjkEef4e07PIbZl69N779w7d0ZSJjPUUEMNNdRQQw011FCSlK+sbC7s1uZquwubK5W86tORrOLj3S0N1/Lu46Lq05KmlfU9jaaxuceqT02GigtUur5mN2+6uxZ3g/h6un+jGTfp7ulz1hXVpymsygMOPkfLU6pPVUybnHyObqIZ83MRADVtV/X5Rlben/807dnpdX3fUf369Anx7voNG3CKD30Ap/WyZZqWK/uPcv2R7xMPbhTi1Bh28k/PDBtuBJWNOXJrEfvUxA1CnJrG+OqmMUKRZVpnGOPWjUEszqLnfW1R+VzG8j30o3Oqz5xTmIs+bZgWC9CRuf8K+fSC6nPnEuaij4xAPltGeRv5/E0oxYso4L1gA7quaiCj6mz6Q7E4FhHQQTyFh9RUA4RpahYD5OBzEE3Eiin306lpAUAnOT4DRz1QzRCooogFe4hleFyai3BfDPID2iNqHRw4rRqDrSlxQDsvwlBMbSQKxmBfVuPSO3ZZNQlDMVzUNSKs3yqqWaiK5aI9wcFmUzUMTfFc1DUiyPtpdNO4LURG7VpSLoSaj7mshl2y6GisJm3VpSZjE5O6v6NKSZpYatnS7a3O8pPlUpKmrH5vS9mP0vXyIe3pDInh6P/H9N8anKmPof3vD/v0P8WAAAAABJRU5ErkJggg==" alt="Logo" class="w-full h-full object-cover">
                    </div>
                    <div class="logo-text">Nest<span>jen</span></div>
                </a>

                <div class="search-bar">
                    <form id="global-search-form">
                        <input type="text" placeholder="Search locations, builders..." id="global-search-input">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </form>
                </div>

                <div class="nav-links" id="nav-actions">
                    <button onclick="router.navigate('#/search?type=Flat')">Flats</button>
                    <button onclick="router.navigate('#/search?type=Shop')">Shops</button>
                    <div style="height: 20px; width: 1px; background: var(--light-gray);"></div>
                </div>
            </div>
        </div>
    </nav>

    <div id="main-content"></div>

    <div class="mobile-floating-search" id="mobile-floating-search">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        <input type="text" placeholder="Search properties..." id="mobile-search-input">
    </div>

    <div class="mobile-nav glass" id="mobile-nav">
        <a href="#/" class="mobile-nav-item" data-path="#/">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span>Home</span>
        </a>
        <a href="#/search" class="mobile-nav-item" data-path="#/search">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <span>Search</span>
        </a>
        <a href="#/favs" class="mobile-nav-item" data-path="#/favs">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
            <span>Saved</span>
        </a>
        <a href="javascript:void(0)" class="mobile-nav-item" id="mobile-profile-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <span id="mobile-profile-text">Join</span>
        </a>
    </div>

    <div id="modal-container" class="modal-overlay"></div>

    <div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
        <button class="lightbox-close"><svg width="24" height="24" fill="white" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" stroke="currentColor" stroke-width="1.5"/></svg></button>
        <img id="lightbox-img" src="" class="lightbox-img" alt="Fullscreen">
    </div>

    <script>
        /**
         * Core Application Logic
         */
        const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz36Ajz6rXGm_QTRiLuBDiOz4sK0M-NrailgSVYc8PUOsq2nUnmMX0kFsOwnBA2CqtBsQ/exec";

        const state = {
            user: JSON.parse(localStorage.getItem('estate_user')) || null,
            properties: [],
            savedIds: JSON.parse(localStorage.getItem('savedProperties')) || [],
            pendingRequests: [],
            isLoading: true
        };

        const formatCurrency = (price) => {
            const num = parseFloat(price);
            if (isNaN(num) || num <= 0) return 'Price on Request';
            if (num >= 10000000) return `₹${(num / 10000000).toFixed(1).replace(/\.0$/, '')} Cr`;
            if (num >= 100000) return `₹${(num / 100000).toFixed(0)} Lacs`;
            return `₹${num.toLocaleString('en-IN')}`;
        };

        const showLoader = (show) => {
            const loader = document.getElementById('global-loader');
            if (show) loader.style.display = 'flex';
            else {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 400);
            }
        };

        async function fetchMarketplace() {
            try {
                const resp = await fetch(`${GAS_WEBAPP_URL}?action=fetch_public_feed`);
                const result = await resp.json();
                if (result.status === 'success') state.properties = result.data;
            } catch (e) { console.error("Cloud fetch failed", e); }
            state.isLoading = false;
            showLoader(false);
            router.refresh();
        }

        const router = {
            currentPath: '',
            navigate(path) { window.location.hash = path; },
            refresh() { this.handleHashChange(); },
            handleHashChange() {
                const hash = window.location.hash || '#/';
                this.currentPath = hash;
                
                document.querySelectorAll('.mobile-nav-item').forEach(el => {
                    el.classList.toggle('active', el.dataset.path === hash);
                });

                const content = document.getElementById('main-content');
                const floatingSearch = document.getElementById('mobile-floating-search');
                
                content.innerHTML = '';
                window.scrollTo(0, 0);

                floatingSearch.style.display = (window.innerWidth <= 768 && (hash === '#/search' || hash.startsWith('#/search?'))) ? 'block' : 'none';

                if (hash === '#/' || hash === '') renderHome(content);
                else if (hash.startsWith('#/property/')) renderDetails(content, hash.split('/').pop());
                else if (hash === '#/search' || hash.startsWith('#/search?')) renderSearch(content, new URLSearchParams(hash.split('?')[1] || ''));
                else if (hash === '#/favs') renderSearch(content, null, true);

                updateNavActions();
            }
        };

        function updateNavActions() {
            const navActions = document.getElementById('nav-actions');
            const mobProfileText = document.getElementById('mobile-profile-text');
            
            if (state.user) {
                navActions.innerHTML = `
                    <button onclick="router.navigate('#/search?type=Flat')">Flats</button>
                    <button onclick="router.navigate('#/search?type=Shop')">Shops</button>
                    <div style="height: 16px; width: 1px; background: var(--light-gray);"></div>
                    <div class="user-profile-badge" onclick="openProfileModal()">
                        <img src="${state.user.photo || 'https://picsum.photos/100/100'}" class="user-avatar">
                        <div class="user-info">
                            <p>Identity</p>
                            <h4>${state.user.name.split(' ')[0]}</h4>
                        </div>
                    </div>
                `;
                mobProfileText.innerText = 'Profile';
            } else {
                navActions.innerHTML = `
                    <button onclick="router.navigate('#/search?type=Flat')">Flats</button>
                    <button onclick="router.navigate('#/search?type=Shop')">Shops</button>
                    <div style="height: 16px; width: 1px; background: var(--light-gray);"></div>
                    <button class="auth-btn" onclick="openLoginModal()">Login</button>
                `;
                mobProfileText.innerText = 'Join';
            }
        }

        function renderPropertyCard(p) {
            const isSaved = state.savedIds.includes(p.id);
            return `
                <article class="property-card animate-fade" onclick="router.navigate('#/property/${p.id}')">
                    <div class="card-image">
                        <img src="${p.images[0]}" alt="${p.title}" loading="lazy">
                        <div class="card-badges"><span class="badge">${p.type}</span></div>
                        <button class="save-btn ${isSaved ? 'active' : ''}" onclick="toggleSave(event, '${p.id}')">
                            <svg class="w-4" fill="${isSaved ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                        </button>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">${p.title}</h3>
                        <p class="card-location"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"></path></svg>${p.location}</p>
                        <div class="card-footer">
                            <div><p class="card-price">${formatCurrency(p.price)}</p><p class="card-area">${p.area} SQ.FT</p></div>
                            <div class="card-arrow"><svg width="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg></div>
                        </div>
                    </div>
                </article>`;
        }

        function renderHome(container) {
            container.innerHTML = `
                <main class="max-w-7xl animate-fade">
                    <section class="hero shadow-sm">
                        <div class="hero-slide active" style="background-image: url('https://images.unsplash.com/photo-1600585154340-be6199f7d009?auto=format&fit=crop&w=1600&q=80')"></div>
                        <div class="hero-overlay">
                            <div class="hero-content">
                                <h1>Discover Your <span>Refuge.</span></h1>
                                <p>Verified direct-to-community listings approved via secure cloud nodes.</p>
                                <button class="hero-btn" onclick="router.navigate('#/search')">Explore Assets</button>
                            </div>
                        </div>
                    </section>
                    <section class="section-header"><div class="section-title"><h2>Latest <span>Approvals.</span></h2><p>Market Feed</p></div></section>
                    <div class="property-grid">${state.properties.length > 0 ? state.properties.slice(0, 12).map(p => renderPropertyCard(p)).join('') : '<p style="padding: 100px 0; opacity: 0.4; grid-column: 1/-1; text-align: center;">Node Empty.</p>'}</div>
                </main>`;
        }

        function renderSearch(container, params, isFavMode = false) {
            let filtered = [...state.properties];
            if (isFavMode) filtered = filtered.filter(p => state.savedIds.includes(p.id));
            else if (params) {
                const q = params.get('q')?.toLowerCase() || '', t = params.get('type') || 'All', c = params.get('city') || 'All';
                if (q) filtered = filtered.filter(p => p.title.toLowerCase().includes(q) || p.location.toLowerCase().includes(q));
                if (t !== 'All') filtered = filtered.filter(p => p.type === t);
                if (c !== 'All') filtered = filtered.filter(p => p.city === c);
            }
            container.innerHTML = `
                <div class="max-w-7xl search-container animate-fade">
                    <button class="mobile-filter-trigger" onclick="toggleSidebar()"><svg width="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16m-7 6h7" stroke-width="2"/></svg>Adjust Terminal</button>
                    <aside class="sidebar" id="search-sidebar">
                        <div class="filter-group"><label class="filter-label">Asset Type</label><div class="filter-btn-grid">
                            <button class="filter-btn ${(!params || params.get('type') === 'All') ? 'active' : ''}" onclick="applyFilter('type', 'All')">All</button>
                            <button class="filter-btn ${(params?.get('type') === 'Flat') ? 'active' : ''}" onclick="applyFilter('type', 'Flat')">Flats</button>
                            <button class="filter-btn ${(params?.get('type') === 'Shop') ? 'active' : ''}" onclick="applyFilter('type', 'Shop')">Shops</button>
                            <button class="filter-btn ${(params?.get('type') === 'Plot') ? 'active' : ''}" onclick="applyFilter('type', 'Plot')">Plots</button>
                        </div></div>
                        <div class="filter-group"><label class="filter-label">Region</label><select class="filter-select" onchange="applyFilter('city', this.value)">
                            <option value="All" ${(!params || params.get('city') === 'All') ? 'selected' : ''}>Everywhere</option>
                            <option value="Ahmedabad" ${(params?.get('city') === 'Ahmedabad') ? 'selected' : ''}>Ahmedabad</option>
                            <option value="Gandhinagar" ${(params?.get('city') === 'Gandhinagar') ? 'selected' : ''}>Gandhinagar</option>
                        </select></div>
                    </aside>
                    <section style="flex: 1">
                        <div class="section-header"><div class="section-title"><h2>${isFavMode ? 'Saved <span>Assets.</span>' : filtered.length + ' <span>Matched.</span>'}</h2></div></div>
                        <div class="property-grid">${filtered.map(p => renderPropertyCard(p)).join('')}</div>
                    </section>
                </div>`;
        }

        function toggleSidebar() { document.getElementById('search-sidebar').classList.toggle('show'); }

        function renderDetails(container, id) {
            const p = state.properties.find(item => item.id === id);
            if (!p) { container.innerHTML = '<p class="p-20 text-center">Data node missing.</p>'; return; }
            container.innerHTML = `
                <div class="max-w-7xl details-container animate-fade">
                    <div class="breadcrumb"><span onclick="router.navigate('#/')">Home</span> / <strong>${p.title}</strong></div>
                    <div class="gallery-grid">
                        <div class="main-image" onclick="openLightbox(document.getElementById('detail-main-img').src)"><img id="detail-main-img" src="${p.images[0]}"><div class="zoom-icon"><svg width="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 3h6m0 0v6m0-6L14 10M9 21H3m0 0v-6m0 6l7-7" stroke-width="2"/></svg></div></div>
                        <div class="thumb-list no-scrollbar">${p.images.map((img, i) => `<div class="thumb-item ${i === 0 ? 'active' : ''}" onclick="updateDetailImage(this, '${img}')"><img src="${img}"></div>`).join('')}</div>
                    </div>
                    <div class="details-content">
                        <div class="info-card">
                            <div class="info-header">
                                <div class="info-title"><span class="badge" style="margin-bottom: 12px; display: inline-block;">${p.type}</span><h1>${p.title}</h1><p class="card-location" style="margin-top: 12px; font-size: 14px;"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"></path></svg>${p.location}</p></div>
                                <div class="info-price"><h2>${formatCurrency(p.price)}</h2><p style="font-size: 10px; opacity: 0.5;">Market Value</p></div>
                            </div>
                            <div class="stats-grid">
                                <div class="stat-item"><p>Total Area</p><h4>${p.area} sqft</h4></div>
                                <div class="stat-item"><p>Status</p><h4>${p.possessionDate}</h4></div>
                                <div class="stat-item"><p>ID</p><h4>${p.id.split('-').pop()}</h4></div>
                                <div class="stat-item"><p>Region</p><h4>${p.city}</h4></div>
                            </div>
                            <div style="margin-top: 32px"><h3 style="font-size: 16px; margin-bottom: 12px;">Description</h3><p style="color: var(--medium-gray); font-size: 15px;">${p.description}</p></div>
                            <div style="margin-top: 32px"><h3 style="font-size: 16px; margin-bottom: 16px;">Amenities</h3><div class="amenities-grid">${p.amenities.map(a => `<div class="amenity-item"><span class="amenity-dot"></span>${a}</div>`).join('')}</div></div>
                        </div>
                        <div class="cta-sidebar">
                            <div class="builder-card"><div class="builder-info"><div class="builder-logo">${p.builder.charAt(0)}</div><div><p style="font-size: 8px; font-weight: 800; color: var(--brand-orange); text-transform: uppercase;">Cloud Node Member</p><h4>${p.builder}</h4></div></div><button class="whatsapp-btn" onclick="openWhatsApp('${p.title}', '${p.location}', '${formatCurrency(p.price)}')">WhatsApp Inquiry</button><button class="inquiry-btn" onclick="openInquiryModal('${p.title}', '${p.id}', '${p.type}', '${formatCurrency(p.price)}')">Request Details</button></div>
                        </div>
                    </div>
                </div>`;
        }

        function openLightbox(src) { document.getElementById('lightbox-img').src = src; document.getElementById('lightbox').classList.add('active'); document.body.style.overflow = 'hidden'; }
        function closeLightbox() { document.getElementById('lightbox').classList.remove('active'); document.body.style.overflow = 'auto'; }
        function applyFilter(key, val) { const [b, q] = (window.location.hash || '#/search').split('?'); const p = new URLSearchParams(q || ''); p.set(key, val); router.navigate(`${b}?${p.toString()}`); }
        function updateDetailImage(el, src) { document.getElementById('detail-main-img').src = src; document.querySelectorAll('.thumb-item').forEach(i => i.classList.remove('active')); el.classList.add('active'); }
        function toggleSave(e, id) { e.stopPropagation(); if (state.savedIds.includes(id)) state.savedIds = state.savedIds.filter(i => i !== id); else state.savedIds.push(id); localStorage.setItem('savedProperties', JSON.stringify(state.savedIds)); e.currentTarget.classList.toggle('active'); const s = e.currentTarget.querySelector('svg'); s.setAttribute('fill', e.currentTarget.classList.contains('active') ? 'currentColor' : 'none'); }
        function openWhatsApp(t, l, p) { window.open(`https://wa.me/9173213576?text=${encodeURIComponent(`Interest: ${t} in ${l} (${p})`)}`, '_blank'); }

        const modalContainer = document.getElementById('modal-container');
        function closeModal() { modalContainer.classList.remove('active'); modalContainer.innerHTML = ''; document.body.style.overflow = 'auto'; }
        
        let authPhotoBase64 = "";
        function openLoginModal(reg = false) {
            authPhotoBase64 = ""; document.body.style.overflow = 'hidden';
            modalContainer.innerHTML = `
                <div class="modal-card animate-fade"><button class="close-modal" onclick="closeModal()"><svg width="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2.5"/></svg></button>
                    <div class="auth-tabs"><button class="auth-tab ${reg ? 'active' : ''}" onclick="openLoginModal(true)">Register</button><button class="auth-tab ${!reg ? 'active' : ''}" onclick="openLoginModal(false)">Login</button></div>
                    ${reg ? `<div class="profile-picker-container"><div class="profile-picker"><img id="auth-pic-preview" class="hidden"><svg id="auth-pic-placeholder" style="width: 48px; color: #CCC;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div><label class="camera-btn"><input type="file" accept="image/*" class="hidden" onchange="handleAuthPhoto(this)"><svg width="18" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg></label></div>` : `<div class="text-center" style="margin-bottom: 24px;"><h2>Hub Access.</h2><p style="font-size: 9px; color: var(--medium-gray);">Identify your terminal</p></div>`}
                    <form id="auth-form">${reg ? `<div class="form-group"><label>Name</label><input type="text" id="a-name" class="form-input" required></div>` : ''}<div class="form-group"><label>Email</label><input type="email" id="a-email" class="form-input" required></div><div class="form-group"><label>Key</label><input type="password" id="a-pass" class="form-input" required></div>${reg ? `<div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;"><div class="form-group"><label>Phone</label><input type="tel" id="a-phone" class="form-input" required></div><div class="form-group"><label>Birth</label><input type="date" id="a-dob" class="form-input" required></div></div>` : ''}<button type="submit" class="form-submit" id="auth-submit-btn">${reg ? 'Initialize Identity' : 'Authorize'}</button></form>
                </div>`;
            modalContainer.classList.add('active');
            document.getElementById('auth-form').onsubmit = async (e) => {
                e.preventDefault(); const btn = document.getElementById('auth-submit-btn'); btn.innerText = 'Syncing...'; btn.disabled = true;
                const em = document.getElementById('a-email').value, ps = document.getElementById('a-pass').value;
                if (reg) {
                    const nu = { name: document.getElementById('a-name').value, email: em, phone: document.getElementById('a-phone').value, password: ps, dob: document.getElementById('a-dob').value, photo: authPhotoBase64 };
                    try { await fetch(GAS_WEBAPP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'sync_user', user: nu }) }); state.user = nu; localStorage.setItem('estate_user', JSON.stringify(nu)); closeModal(); updateNavActions(); router.refresh(); } catch (err) { alert('Offline.'); btn.disabled = false; btn.innerText = 'Initialize'; }
                } else {
                    try { const r = await fetch(`${GAS_WEBAPP_URL}?action=verify_user&email=${encodeURIComponent(em)}&password=${encodeURIComponent(ps)}`); const rs = await r.json(); if (rs.status === 'success') { state.user = rs.user; localStorage.setItem('estate_user', JSON.stringify(rs.user)); closeModal(); updateNavActions(); router.refresh(); } else { alert(rs.message); btn.disabled = false; btn.innerText = 'Authorize'; } } catch (e) { alert('Sync Failed.'); btn.disabled = false; }
                }
            };
        }

        function handleAuthPhoto(inp) { if (inp.files?.[0]) { const r = new FileReader(); r.onload = (e) => { authPhotoBase64 = e.target.result; const p = document.getElementById('auth-pic-preview'), pl = document.getElementById('auth-pic-placeholder'); p.src = e.target.result; p.classList.remove('hidden'); pl.classList.add('hidden'); }; r.readAsDataURL(inp.files[0]); } }

        function openProfileModal() {
            document.body.style.overflow = 'hidden';
            modalContainer.innerHTML = `
                <div class="modal-card animate-fade" style="padding: 0; overflow: hidden"><button class="close-modal" onclick="closeModal()" style="top: 20px; right: 20px;"><svg width="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2.5"/></svg></button>
                    <div class="profile-header"><h2>Portal.</h2><img src="${state.user.photo || 'https://picsum.photos/100/100'}" class="profile-avatar-large"></div>
                    <div class="profile-content" style="padding: 32px">
                        <h3 style="font-size: 24px;">${state.user.name}</h3><p style="font-size: 10px; color: var(--brand-orange); text-transform: uppercase;">Hub Member</p>
                        <div class="profile-stat-bar"><div class="profile-stat-box"><p>Market</p><h3>0</h3></div><div class="profile-stat-box"><p>Saved</p><h3>${state.savedIds.length}</h3></div></div>
                        <button class="form-submit" onclick="openAddListingModal()">Add New Asset</button>
                        <div id="pending-container" style="margin-top: 20px">${state.pendingRequests.length > 0 ? state.pendingRequests.map(r => `<div class="pending-card"><h5>${r.title}</h5><div class="pending-progress"><div class="pending-progress-bar"></div></div><p style="font-size: 8px; opacity: 0.5;">Verifying...</p></div>`).join('') : '<p style="text-align:center; padding: 20px; opacity: 0.4; font-size: 11px;">Queue Empty.</p>'}</div>
                        <button onclick="handleLogout()" style="width:100%; border:none; background:#FFF1F1; color:#E54; font-size:10px; font-weight:800; padding:16px; border-radius:12px; cursor:pointer; margin-top:20px; text-transform:uppercase;">Disconnect</button>
                    </div>
                </div>`;
            modalContainer.classList.add('active');
        }

        function handleLogout() { state.user = null; localStorage.removeItem('estate_user'); closeModal(); updateNavActions(); router.navigate('#/'); }

        let tempListingImages = [];
        function openAddListingModal() {
            tempListingImages = [];
            modalContainer.innerHTML = `
                <div class="modal-card animate-fade" style="max-width: 580px"><button class="close-modal" onclick="closeModal()"><svg width="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2.5"/></svg></button>
                    <div style="margin-bottom: 24px;"><h2>New Asset.</h2><p style="font-size: 9px; color: var(--medium-gray);">Deployment workflow</p></div>
                    <form id="listing-form">
                        <div class="form-group"><label>Media (4-8)</label><div class="image-uploader-grid" id="listing-img-grid"><label class="image-uploader-box"><input type="file" multiple accept="image/*" class="hidden" onchange="handleListingUpload(this)"><svg width="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="2.5"/></svg><span style="font-size: 8px; margin-top: 4px;">ADD</span></label></div></div>
                        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;"><div class="form-group"><label>Title</label><input type="text" id="l-title" class="form-input" required></div><div class="form-group"><label>Type</label><select id="l-type" class="filter-select"><option value="Flat">Flat</option><option value="Shop">Shop</option><option value="Plot">Plot</option></select></div></div>
                        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;"><div class="form-group"><label>Price (₹)</label><input type="number" id="l-price" class="form-input" required></div><div class="form-group"><label>Area (sqft)</label><input type="number" id="l-area" class="form-input" required></div></div>
                        <div class="form-group"><label>Location</label><input type="text" id="l-location" class="form-input" required></div>
                        <button type="submit" class="form-submit" id="listing-submit-btn">Authorize Deployment</button>
                    </form>
                </div>`;
            modalContainer.classList.add('active');
            document.getElementById('listing-form').onsubmit = (e) => {
                e.preventDefault(); if (tempListingImages.length < 4) { alert('4 photos needed.'); return; }
                const b = document.getElementById('listing-submit-btn'); b.innerText = 'Deploying...'; b.disabled = true;
                const nu = { id: 'prop-' + Date.now(), title: document.getElementById('l-title').value, type: document.getElementById('l-type').value, price: document.getElementById('l-price').value, area: document.getElementById('l-area').value, location: document.getElementById('l-location').value, images: tempListingImages };
                state.pendingRequests.push(nu); fetch(GAS_WEBAPP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'add_listing_request', property: nu }) }).then(() => { closeModal(); openProfileModal(); });
            };
        }

        function handleListingUpload(inp) { if (inp.files) Array.from(inp.files).forEach(f => { if (tempListingImages.length >= 8) return; const r = new FileReader(); r.onload = (e) => { tempListingImages.push(e.target.result); renderListingImages(); }; r.readAsDataURL(f); }); }
        function renderListingImages() { const g = document.getElementById('listing-img-grid'); if (!g) return; const up = g.querySelector('label'); g.innerHTML = ''; tempListingImages.forEach((s, i) => { const b = document.createElement('div'); b.className = 'uploaded-img-box'; b.innerHTML = `<img src="${s}"><button class="remove-img-btn" onclick="removeTempImg(${i})">×</button>`; g.appendChild(b); }); if (tempListingImages.length < 8 && up) g.appendChild(up); }
        function removeTempImg(i) { tempListingImages.splice(i, 1); renderListingImages(); }

        function openInquiryModal(t, id, ty, p) {
            document.body.style.overflow = 'hidden';
            modalContainer.innerHTML = `
                <div class="modal-card animate-fade"><button class="close-modal" onclick="closeModal()"><svg width="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" stroke-width="2.5"/></svg></button>
                    <div style="margin-bottom: 24px;"><h2>Inquiry.</h2><p style="font-size: 10px; color: var(--brand-orange);">${t}</p></div>
                    <form id="inquiry-form"><div class="form-group"><label>Name</label><input type="text" id="i-name" class="form-input" value="${state.user?.name || ''}" required></div><div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;"><div class="form-group"><label>Phone</label><input type="tel" id="i-phone" class="form-input" value="${state.user?.phone || ''}" required></div><div class="form-group"><label>Email</label><input type="email" id="i-email" class="form-input" value="${state.user?.email || ''}" required></div></div><div class="form-group"><label>Message</label><textarea id="i-msg" class="form-input" style="height: 100px; resize: none;"></textarea></div><button type="submit" class="form-submit" id="inquiry-submit-btn">Send Sync Request</button></form>
                </div>`;
            modalContainer.classList.add('active');
            document.getElementById('inquiry-form').onsubmit = (e) => {
                e.preventDefault(); const b = document.getElementById('inquiry-submit-btn'); b.innerText = 'Locking...'; b.disabled = true;
                const d = { action: 'submit_inquiry', propertyName: t, propertyId: id, propertyType: ty, propertyPrice: p, userName: document.getElementById('i-name').value, userPhone: document.getElementById('i-phone').value, userEmail: document.getElementById('i-email').value, message: document.getElementById('i-msg').value };
                fetch(GAS_WEBAPP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(d) }).then(() => { modalContainer.innerHTML = `<div class="modal-card animate-fade text-center"><div style="width: 72px; height: 72px; background: #EEFFF5; color: #2ecc71; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;"><svg width="36" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></div><h2>Synced.</h2><p style="font-size: 11px; opacity: 0.6; margin-top: 10px;">Request logged to cloud</p><button class="form-submit" style="margin-top: 32px;" onclick="closeModal()">Finish</button></div>`; });
            };
        }

        window.addEventListener('hashchange', () => router.handleHashChange());
        window.addEventListener('scroll', () => document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 20));
        document.getElementById('global-search-form').onsubmit = (e) => { e.preventDefault(); router.navigate(`#/search?q=${encodeURIComponent(document.getElementById('global-search-input').value)}`); };
        document.getElementById('mobile-search-input').onkeyup = (e) => { if (e.key === 'Enter') { router.navigate(`#/search?q=${encodeURIComponent(e.target.value)}`); e.target.blur(); } };
        document.getElementById('mobile-profile-btn').onclick = () => state.user ? openProfileModal() : openLoginModal(false);

        fetchMarketplace();
        setInterval(() => {
            const slides = ['https://images.unsplash.com/photo-1600585154340-be6199f7d009?auto=format&fit=crop&w=1600&q=80', 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=1600&q=80'];
            const el = document.querySelector('.hero-slide');
            if (el && (window.location.hash === '#/' || !window.location.hash)) {
                const ci = slides.indexOf(el.style.backgroundImage.slice(5, -2));
                el.style.backgroundImage = `url('${slides[(ci + 1) % slides.length]}')`;
            }
        }, 6000);
        router.handleHashChange();
    </script>
</body>
</html>
